(function(){var p,c,g,q,f,h,l,r,s,m,t,u,v,n,b;h=function(){return console.log.apply(console,arguments)};this.tr=function(a){return i18nBean.tr(a)};f=function(a){return a};s=function(a){return f("http://153.121.54.194/upload/image/"+a.id+"."+a.suffix)};r=function(a,d){null==d&&(d=128);return a?d?f("http://media.getchute.com/media/"+a+"/"+d+"x"+d):f("http://media.getchute.com/media/"+a):""};v=function(a){return null==a?"":bbcode.parse(linkify(_.escape(a.replace(/]\n/g,"]")))).replace(/<li><\/li>/g,
"<li>")};l=function(a,d){var b;try{if("number"===(b=typeof a)||"string"===b)a*=1E3;return a?moment(a).format(d):""}catch(e){return""}};p=Haml('.post(data-id="#{id}" data-type="#{type}")\n  .left\n    :if userAvatar\n      %img.img-circle.avatar(src="#{userAvatar}")\n  .right\n    .head\n      .user(style="#{userStyle}") #{userName}\n      .time.text-minor = createTime\n      .lang = lang\n      .time.text-success = updateTime\n    .content.bbcode = content\n    .foot\n    :if image\n      .image\n        %a(href="#{image.url}" title="#{image.title}")\n          %img(src="#{image.url}" alt="#{image.title}")\n  .reply\n%hr');
n=function(a){return p({id:a.id,type:a.type,userName:a.userName,userStyle:a.userColor?"color:"+a.userColor:"",lang:a.lang,userAvatar:r(a.userAvatar),content:v(a.content),createTime:l(a.createTime,"H:mm M/D/YY ddd"),updateTime:a.updateTime>a.createTime?l(a.updateTime,"H:mm M/D/YY ddd"):"",image:a.image?{title:a.image.title,url:s(a.image)}:null})};g=function(a){var d,b,e,c,f,g,k;b=function(){var b,c,d;d=[];b=0;for(c=a.length;b<c;b++)e=a[b],"post"===e.type&&d.push(n(e));return d}().join("");$(".topic > .posts").append(b);
c=function(){var b,c,d;d=[];b=0;for(c=a.length;b<c;b++)e=a[b],"reply"===e.type&&d.push(e);return d}();if(c.length){c=_.sortBy(c,function(a){return a.createTime});k=[];f=0;for(g=c.length;f<g;f++)e=c[f],d=$(".post[data-id="+e.replyId+"]"),d.length?(b=n(e),k.push(d.children(".reply").append(b))):k.push(h("appendPosts: error: post lost"));return k}};b=function(a){return $("#spin").spin(a?"large":!1)};c=0;u=function(){b(!0);return rest.forum.list("post",{data:{topic:TOPIC_ID,sort:"createTime",asc:!1,limit:20},
error:function(){b(!1);return growl.warn(tr("Internet error"))},success:function(a){b(!1);return a.length?(c+=a.length,g(a)):growl.warn(tr("Internet error"))}})};t=function(){b(!0);return rest.forum.list("post",{data:{topic:TOPIC_ID,sort:"createTime",asc:!1,first:c,limit:20},error:function(){b(!1);return growl.warn(tr("Internet error"))},success:function(a){b(!1);return a.length?(c+=a.length,g(a)):growl(tr("No more"))}})};q=function(){return $(".topic > .foot > .btn-more").click(function(){var a;
a=$(this);a.data("locked")||(a.data("lock",!0),t(),a.data("lock",!1));return!1})};m=function(){if(null==this.i18nBean)return h("init: wait"),setTimeout(m,100);h("init: enter");moment.locale("ja");this.TOPIC_ID=$(".topic").data("id");q();u();return h("init: leave")};$(function(){return m()})}).call(this);
