(function(){var f,d,b,g,h,e,k,l,m,n,p;b=function(){return console.log.apply(console,arguments)};d=function(a){return a};h=function(a,c){null==c&&(c=128);return a?c?d("http://media.getchute.com/media/"+a+"/"+c+"x"+c):d("http://media.getchute.com/media/"+a):""};l=function(a){return null==a?"":bbcode.parse(linkify(_.escape(a.replace(/]\n/g,"]")))).replace(/<li><\/li>/g,"<li>")};g=function(a,c){var b;try{if("number"===(b=typeof a)||"string"===b)a*=1E3;return a?moment(a).format(c):""}catch(d){return""}};
f=Haml('.post\n  .left\n    :if userAvatar\n      %img.img-circle.avatar(src="#{userAvatar}")\n  .right\n    .head\n      .user(style="#{userStyle}") #{userName}\n      .time = createTime\n    .content = content\n%hr');m=function(a){return f({userName:a.userName,userStyle:a.userColor?"color:"+a.userColor:"",userAvatar:h(a.userAvatar,50),content:l(a.content),createTime:g(a.createTime,"H:mm M/D/YY ddd")})};n=function(a){return a.map(m).join("")};p=function(a){a=n(a);return $(".topic > .posts").html(a)};
k=function(){return rest.forum.list("post",{data:{topic:TOPIC_ID,limit:20},error:function(){},success:function(a){if(a.length)return p(a)}})};e=function(){if(null==this.cacheBean)return b("init: wait"),setTimeout(e,100);b("init: enter");moment.locale("ja");this.TOPIC_ID=$(".topic").data("id");k();return b("init: leave")};$(function(){return e()})}).call(this);
