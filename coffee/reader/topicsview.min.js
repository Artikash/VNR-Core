(function(){var g,h,d,k,e,l,f;d=function(){Array.prototype.unshift.call(arguments,"topicsview:");return console.log.apply(console,arguments)};this.READY=!1;l=function(a){return postInputBean.newPost(a,"post")};f=function(a,c,b){return topicInputBean.newTopic(a,c,b)};k=function(a){return topicEditBean.editTopic(JSON.stringify(a))};this.spin=function(a){a?this.spin.count+=1:--this.spin.count;return $("#spin").spin(0<this.spin.count?"large":!1)};this.spin.count=0;this.addTopic=function(a){var c,b;if(READY)return"review"===
a.type?null!=(c=this.reviewView)?c.addTopic(a):void 0:null!=(b=this.topicView)?b.addTopic(a):void 0};this.updateTopic=function(a){var c,b;if(READY)return"review"===a.type?null!=(c=this.reviewView)?c.updateTopic(a):void 0:null!=(b=this.topicView)?b.updateTopic(a):void 0};this.addPost=function(a){var c;if(READY)return null!=(c=this.postView)?c.addPost(a):void 0};this.updatePost=function(a){var c;if(READY)return null!=(c=this.postView)?c.updatePost(a):void 0};h=function(){var a,c,b;c=$(".sec.sec-review .forum-topics");
c.length||(c=void 0);a=$(".sec-reviews");b={type:"review"};SUBJECT_ID&&(b.subjectId=SUBJECT_ID,b.subjectType="game");this.reviewView=new topicsjs.TopicList({$container:a.find("> .sec-content > .forum-topics"),$more:a.find("> .sec-content > .footer > .btn-more"),$newReview:a.find(".new-topic"),$userReview:c,search:b,complete:!TOPIC_ID});a=$(".sec-topics");b={notype:"review"};SUBJECT_ID&&(b.subjectId=SUBJECT_ID);this.topicView=new topicsjs.TopicList({$container:a.find("> .sec-content > .forum-topics"),
$more:a.find("> .sec-content > .footer > .btn-more"),search:b,complete:!TOPIC_ID});reviewView.show();topicView.show();a=$(".sec-posts");if(TOPIC_ID)return this.postView=new postsjs.PostList({$container:a.find("> .sec-content > .forum-posts"),$more:a.find("> .sec-content > .footer > .btn-more"),topicId:TOPIC_ID,search:{sort:"updateTime",asc:!1}}),postView.show()};g=function(){var a;$(".sec-btn").click(function(){var a,b;b=$(this);a=b.parent(".sec");a.length&&(a=a.find(".sec-content"),a.is(":empty")&&
b.hasClass("checked")||(b.toggleClass("checked"),a.is(":empty")||a.toggle("fade")));return!1});a=$(".sec.sec-topics");a.find(".new-topic").click(function(){var a,b;SUBJECT_ID?(a=SUBJECT_ID,b="game"):(a=101,b="subject");f("chat",a,b);return!1});a=$(".sec.sec-reviews");a.find(".new-topic").hide().click(function(){var a;SUBJECT_ID&&((a=reviewView.findUserReview())?k(a):f("review",SUBJECT_ID,"game"));return!1});a=$(".sec.sec-posts");return a.find(".new-post").click(function(){l(TOPIC_ID);return!1})};
e=function(){if(null==this.i18nBean)return d("init: wait"),setTimeout(e,100);d("init: enter");moment.locale(LOCALE);topicsjs.init();postsjs.init();h();g();this.READY=!0;return d("init: leave")};$(function(){return e()})}).call(this);
