(function(){var g,n,p,q,r,s,t,u,v,c,f,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,e=function(a,b){return function(){return a.apply(b,arguments)}},M=[].indexOf||function(a){for(var b=0,d=this.length;b<d;b++)if(b in this&&this[b]===a)return b;return-1};c=function(){};this.tr=function(a){return i18nBean.tr(a)};u=function(){this.HAML_SAMPLE_IMAGE=Haml('%a(href="#{url}" title="#{url}")\n  %img.img-rounded.zoom.zoom-cg(src="#{url}")');this.HAML_VIDEO=Haml(('.video(data-id="${vid}")\n  .header\n    %a.tts(role="button" data-text="${title}" title="TTS")\n      %span.fa.fa-volume-down\n    %a.title.cursor-pointer(title="'+
tr("Play")+'") ${title}\n    :if date\n      .date ${date}\n    .toolbar.pull-right\n      %button.close(type="button" title="'+tr("Close")+'") &times\n      %a.btn.btn-link.btn-xs(role="button" href="http://youtube.com/watch?v=${vid}" title="http://youtube.com/watch?v=${vid}")\n        %span.fa.fa-external-link\n  .image\n    %img.img-rounded(src="${img}" title="${title} ${date}")\n  .iframe').replace(/\$/g,"#"));return this.HAML_CHARA=Haml('.chara\n  .header\n    :if it.label == "\u4e3b\u4eba\u516c" || label == "\u3010\u4e3b\u4eba\u516c\u3011"\n      .text-danger(title="#{yomi}") #{name}\n    :else\n      .text-default(title="#{yomi}") #{name}\n  :if img\n    .body: %a(href="#{img}" title="#{it.name} #{label}")\n      %img.img-rounded(src="#{img}")\n  .footer\n    :if cv\n      .text-info #{cv}\n    :else\n      %span.muted (CV\u7121\u3057)')};
v=function(a){return twttr.widgets.createTimeline(a.id,a.el,a.callback,a.options)};K=function(a){return HAML_SAMPLE_IMAGE({url:a})};G=function(){return gameBean.getSampleImages().split(",").map(K).join("")};L=function(a){null==a.date&&(a.date="");a.img=gameBean.getYouTubeImageUrl(a.vid,!0);return HAML_VIDEO(a)};I=function(){return JSON.parse(gameBean.getVideos()).map(L).join("")};H=function(a){return'<iframe width="480" height="360" src="http://youtube.com/embed/'+a+'" frameborder="0" allowfullscreen />'};
J=function(a){return HAML_CHARA(a)};F=function(a){return JSON.parse(gameBean.getCharacters(a)).map(J).join("")};this.initAmazonReview=function(){var a;c("initAmazonReview: enter");a=$("iframe.amazon");a.load(function(){var a,d;d=$(this);a=d.contents().find("body");return a.html()?(a.css("background-color","transparent").find(".crIFrame").css("margin-left","-0.8em"),a.find(".crIFrameLogo,.crIframeHeaderTitle").remove()):d.remove()});$(window).on("scroll resize",function(){var b;b=this.viewBean.width();
return a.width(b-74)});$("iframe.amazon").error(function(){return $(this).remove()});return c("initAmazonReview: leave")};g=1;n=function(){function a(a){this.viewBean=a;this.youtubeFrameHeight=e(this.youtubeFrameHeight,this);this.youtubeFrameWidth=e(this.youtubeFrameWidth,this);this.zoomYoutube=e(this.zoomYoutube,this);this.youtubeWidth=e(this.youtubeWidth,this);this.zoom=e(this.zoom,this);this.bind=e(this.bind,this);this.maxWidth=e(this.maxWidth,this);this.ratio=1;this.bind()}a.prototype.maxWidth=
function(){return Math.max(0,this.viewBean.width()-90)};a.prototype.bind=function(){return $(window).resize(function(a){return function(){return a.zoomYoutube(a.ratio)}}(this))};a.prototype.zoom=function(a){var d;g=this.ratio=a;$("img.zoom.zoom-cover").width(230*(a+1)/2);d=$("img.zoom.zoom-cg");d.length&&(d.width(220*a),$("section.cg .images").masonry());return this.zoomYoutube(a)};a.prototype.youtubeWidth=function(a){return Math.min(220*(null!=a?a:this.ratio),this.maxWidth())};a.prototype.zoomYoutube=
function(a){return $(".youtube:not(.iframe)").width(this.youtubeWidth*a)};a.prototype.youtubeFrameWidth=function(){return Math.min(480*this.ratio,Math.max(480,this.maxWidth()))};a.prototype.youtubeFrameHeight=function(){return 9*this.youtubeFrameWidth()/16};return a}();C=function(){var a;c("bindToolbar: enter");this.zoomer=new n(this.viewBean);a=new ZoomSlider(function(a){return function(d){return a.zoomer.zoom(1+2*d)}}(this));new Toolbar(this.viewBean,{width:60,height:244,move:a.reloadOffset});return c("bindToolbar: leave")};
A=function(){c("bindRuby: enter");$.fn.inject=function(){return this.each(function(){return window.injectruby(this)})};$(".ruby").inject();return c("bindRuby: leave")};w=function(){var a,b;b=$("section.cg");a=b.find(".images");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,k){if(k){if(a.hasClass("rendered"))return a.fadeIn().masonry;a.hide().html(G()).addClass("rendered").fadeIn().masonry({itemSelector:"img",isFitWidth:!0});return a.find("img").load(function(){0<=
M.call(this.src,"pics.dmm.")&&90===this.naturalWidth&&122===this.naturalHeight?a.masonry("remove",this):this.width=220*g;return a.masonry()})}return a.fadeOut()})};D=function(){var a,b;b=$("section.twitter");a=b.find(".widgets");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,k){var c,e,l,g,f,m;if(window.twttr)if(k){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");if(c=gameBean.getTwitterWidgets()){f=c.split(",");m=[];l=0;for(g=
f.length;l<g;l++)e=f[l],c=document.createElement("div"),c.className="timeline",a.append(c),m.push(v({id:e,el:c,options:{lang:i18nBean.lang(),width:300,height:500,chrome:"transparent noborders noheader",showReplies:!0}}));return m}}else return a.fadeOut()})};E=function(){var a,b;b=$("section.youtube");a=b.find(".videos");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,k){return k?(a.hide().html(I()).fadeIn(),t()):a.empty()})};t=function(){var a;a=$("section.youtube .video");
if(a.length)return a.find(".image > img").load(function(){var a;if(120===this.naturalWidth)return a=$(this),a=a.closest(".video").data("id"),this.src=a=gameBean.getYouTubeImageUrl(a,!1)}),a.find(".tts").click(function(){return ttsBean.speak(this.dataset.text)}),a.find("a.title,img,button.close").click(function(){var a,d;d=$(this).closest(".video");d.find("img");a=d.find("iframe");a.length?(d.removeClass("play"),a.remove()):(d.addClass("play"),a=d.data("id"),a=H(a),d.find(".iframe").html(a));return!1})};
B=function(){w();D();return E()};y=function(){var a,b;b=$("section.descriptions");a=b.find(".contents");return b.find(".nav.nav-pills > li > a").click(function(){var d,b,c;b=$(this).parent("li");b.hasClass("active")||(d=b.parent("ul").children("li.active").removeClass("active").data("type"),b.addClass("active"),b=b.data("type"),d&&a.children("."+d).hide(),b&&(d=a.children("."+b),d.length?d.fadeIn():(c=gameBean.getDescription(b),d=document.createElement("div"),d.className=b,d.innerHTML=c,$(d).hide().appendTo(a))));
return!1})};x=function(){var a,b;b=$("section.characters");a=b.find(".contents");return b.find(".nav.nav-pills > li > a").click(function(){var b,c;c=$(this).parent("li");c.hasClass("active")||(b=c.parent("ul").children("li.active").removeClass("active").data("type"),c.addClass("active"),c=c.data("type"),b&&a.children("."+b).hide(),c&&(b=a.children("."+c),b.length?b.fadeIn():(F(c),b=document.createElement("div"),b.className=c,b.innerHTML=h,$(b).hide().appendTo(a))));return!1})};z=function(){x();return y()};
p=function(){$(".btn-dl-img").click(function(){gameBean.saveImages();return!1});return $(".btn-dl-yt").click(function(){gameBean.saveVideos();return!1})};s=function(){return $(".tts").click(function(){return ttsBean.speak(this.dataset.text)})};r=function(){return $("a.search").click(function(){var a;a=this.dataset.text||$.trim(this.textContent);return gameBean.search(a)})};q=function(){return $(".draggable").draggable().find("button.close").click(function(){return $(this).closest(".draggable").fadeOut()})};
f=function(){if(null==this.gameBean)return c("init: wait"),setTimeout(f,100);c("init: enter");u();C();B();z();A();p();s();r();q();return c("init: leave")};$(function(){return f()})}).call(this);
