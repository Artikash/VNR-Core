(function(){var C,D,q,E,m,p,r,t,F,G,H,I,J,u,v,K,L,M,N,O,P,k,Q,R,S,w,T,U,V,W,X,Y,Z,aa,ba,ca,da,ea,fa,ga,ha,ia,n,x,ja,y,ka,la,z,ma,na,oa,pa,qa,ra,A,B,sa,ta,ua,s,va,h=function(a,b){return function(){return a.apply(b,arguments)}};k=function(){};ra=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(choco.Timer,arguments,function(){})};O=function(){this.HTML_EMPTY=Haml.render(".empty "+("("+tr("Empty")+")"));this.HTML_NOMORE=Haml.render(".empty "+
("("+tr("No more")+")"));this.HTML_MORE=Haml.render('%button.btn-more.btn.btn-info(type="button" title="'+tr("More")+'") '+tr("More"));this.HAML_SAMPLE_IMAGE=Haml('%a(href="#{url}" title="#{url}")\n  %img.img-rounded.zoom.zoom-cg(src="#{url}")');this.HAML_VIDEO=Haml(('.video(data-id="${vid}")\n  .header\n    %a.tts(role="button" data-text="${title}" title="TTS")\n      %span.fa.fa-volume-down\n    %a.title.cursor-pointer(title="'+tr("Play")+'") = title\n    :if date\n      .date = date\n    .toolbar.pull-right\n      %button.close(type="button" title="'+
tr("Close")+'") &times;\n      %button.btn.btn-dl.btn-link.btn-xs(type="button" title="'+tr("Download")+'")\n        %span.fa.fa-download\n      %a.btn.btn-link.btn-xs(role="button" href="http://youtube.com/watch?v=${vid}" title="http://youtube.com/watch?v=${vid}")\n        %span.fa.fa-external-link\n  .image\n    %img.img-rounded(src="${img}" title="${title} ${date}")\n  .iframe').replace(/\$/g,"#"));this.HAML_SETTINGS=Haml(".body.form-horizontal\n  :if file.encoding\n    .row.encoding\n      %label.control-label.col-xs-2 = tr('Encoding')\n      .form-control-static.col-xs-10 = file.encoding.toUpperCase()\n  :if file.threads\n    :if file.threads.scene\n      .row.thread\n        %label.control-label.col-xs-2 \u5bfe\u8a71\n        .form-control-static.col-xs-10\n          = file.threads.scene.name\n          = ' '\n          = file.threads.scene.sig.toString(16)\n    :if file.threads.name\n      .row.thread\n        %label.control-label.col-xs-2 \u540d\u524d\n        .form-control-static.col-xs-10\n          = file.threads.name.name\n          = ' '\n          = file.threads.name.sig.toString(16)\n  .row.hcode\n    %label.control-label.col-xs-2 = tr('H-code')\n    .form-control-static.col-xs-10\n      :if file.hook\n        %span.text-danger = file.hook.text\n        :if file.hook.locked\n          %b.text-info = ' (' + tr('Locked') + ')'\n          %i.text-muted.text-xs\n            = ' -- '\n            = tr('This h-code is definite correct and not allowed to change')\n      :else\n        %span.text-muted = tr('Not specified')");
this.HAML_USERS=Haml((':for it in users\n  :if it.userName && it.count\n    .user(data-name="${it.userName}")\n      :if it.userAvatarUrl\n        %a.user-link(title="'+tr("Show")+'")\n          %img.img-circle.avatar(src="${it.userAvatarUrl}")\n      .header\n        %a.user-link(title="'+tr("Show")+'") @${it.userName}\n      .footer ${it.count} / ${it.langName}').replace(/\$/g,"#"));this.HAML_SCAPE_REVIEWLIST=Haml(".list = entries\n.footer\n  :if empty\n    .empty "+("("+tr("No more")+")")+'\n  :else\n    %button.btn-more.btn.btn-info(type="button" title="'+
tr("More")+'") '+tr("More"));this.HAML_SCAPE_REVIEW=Haml(('.entry.entry-new(data-content-length="${contentLength}")\n  .header\n    %span.field.text-minor = count\n    :if date\n      %span.field.text-success = date\n    :if score\n      %span.field.text-danger\u00a0${score}/100\n    :if ecchiScore\n      %span.field.text-info H:${ecchiScore}/5\n    %a.user.pull-right(href="${userUrl}" title="${userUrl}") @${user}\n    :if netabare\n      %span.netabare.field.pull-right.text-danger = \'(\u30cd\u30bf\u30d0\u30ec)\'\n  .body\n    :if title\n      .title.annot(title="\u4e00\u8a00\u30b3\u30e1\u30f3\u30c8") = title\n    :if content\n      :if lessContent\n        .content.annot.content-more.inactive(title="\u30e1\u30e2") = content\n        .content.annot.content-less(title="\u30e1\u30e2") = lessContent\n        %a.btn-more.btn.btn-link(role="button" title="'+
tr("More")+'") = "'+tr("More")+' (" + contentLength + ")"\n      :else\n        .content.annot(title="\u30e1\u30e2") = content').replace(/\$/g,"#"));this.HAML_REVIEW_TOPIC=Haml(('.topic.topic-new(data-id="${id}" data-type="review")\n  .left\n    :if userAvatarUrl\n      %img.img-circle.avatar(src="${userAvatarUrl}")\n  .right\n    .header(style="${userStyle}")\n      .user @${userName}\n      :if scores\n        :if scores.overall != undefined\n          .score.score-overall.text-danger ${scores.overall}/10\n        :if scores.ecchi != undefined\n          .score.score-ecchi.text-info H:${scores.ecchi}/10\n      .time.text-minor = createTime\n      .lang = lang\n      .time.text-success = updateTime\n    .content.bbcode = content\n    :if USER_NAME && USER_NAME != \'guest\'\n      .footer\n        .btn-group.reply-group\n          :if postCount\n            %a.btn.btn-link.btn-posts(role="button" title="'+
tr("More")+'")\n              '+tr("Replies")+" (${postCount})\n          :else\n            .text-minor ("+tr("No replies")+')\n        .btn-group.like-group.fade-in\n          %a.like.btn.btn-link.btn-sm(role="button" title="'+tr("Like")+'")\n            %span.fa.fa-thumbs-up\n            %span.value = likeCount\n          %a.dislike.btn.btn-link.btn-sm(role="button" title="'+tr("Dislike")+'")\n            %span.fa.fa-thumbs-down\n            %span.value = dislikeCount\n        -#.btn-group.pull-right.fade-in\n        -#  :if userName == USER_NAME\n        -#    %a.btn.btn-link.btn-sm.btn-edit(role="button" title="'+
tr("Edit")+'") '+tr("Edit")+'\n        -#  %a.btn.btn-link.btn-sm.btn-reply(role="button" title="'+tr("Reply")+'") '+tr("Reply")+'\n    :if image\n      .image\n        %a(href="${image.url}" title="${image.title}")\n          %img(src="${image.url}" alt="${image.title}")\n  .reply').replace(/\$/g,"#"));return this.HAML_POST=Haml(('.post.post-new(data-id="${id}" data-type="${type}")\n  .left\n    :if userAvatarUrl\n      %img.img-circle.avatar(src="${userAvatarUrl}")\n  .right\n    .header\n      .user(style="${userStyle}") @${userName}\n      .time.text-minor = createTime\n      .lang = lang\n      .time.text-success = updateTime\n    .content.bbcode = content\n    :if USER_NAME && USER_NAME != \'guest\'\n      .footer\n        .btn-group.like-group.fade-in\n          %a.like.btn.btn-link.btn-sm(role="button" title="'+
tr("Like")+'")\n            %span.fa.fa-thumbs-up\n            %span.value = likeCount\n          %a.dislike.btn.btn-link.btn-sm(role="button" title="'+tr("Dislike")+'")\n            %span.fa.fa-thumbs-down\n            %span.value = dislikeCount\n        -#.btn-group.pull-right.fade-in\n        -#  :if userName == USER_NAME\n        -#    %a.btn.btn-link.btn-sm.btn-edit(role="button" title="'+tr("Edit")+'") '+tr("Edit")+'\n        -#  %a.btn.btn-link.btn-sm.btn-reply(role="button" title="'+tr("Reply")+
'") '+tr("Reply")+'\n    :if image\n      .image\n        %a(href="${image.url}" title="${image.title}")\n          %img(src="${image.url}" alt="${image.title}")\n  .reply').replace(/\$/g,"#"))};r=function(){function a(a,c,d){this.$el=a;this.count=null!=c?c:0;this.preset=null!=d?d:"section";this.dec=h(this.dec,this);this.inc=h(this.inc,this);this.count&&this.$el.spin("section")}a.prototype.inc=function(a){null==a&&(a=1);if(0<a)return 0>=this.count&&this.$el.spin(this.preset),this.count+=a};a.prototype.dec=
function(a){null==a&&(a=1);if(0<a&&(this.count-=a,0>=this.count))return this.$el.spin(!1)};return a}();D=function(){function a(a,c){this.$container=a;this.paused=null!=c?c:!1;this.resume=h(this.resume,this);this.pause=h(this.pause,this);this.timer=ra(600,this.pause)}a.prototype.pause=function(){this.paused||(this.paused=!0,this.$container.masonry({isAnimated:!1,transitionDuration:0}));return this.timer.start()};a.prototype.resume=function(){this.timer.stop();if(this.paused)return this.paused=!1,this.$container.masonry({isAnimated:!0,
transitionDuration:400})};return a}();t=1;F=function(){function a(a){this.viewBean=a;this.youtubeFrameHeight=h(this.youtubeFrameHeight,this);this.youtubeFrameWidth=h(this.youtubeFrameWidth,this);this.zoomYoutube=h(this.zoomYoutube,this);this.youtubeWidth=h(this.youtubeWidth,this);this.zoom=h(this.zoom,this);this.bind=h(this.bind,this);this.maxWidth=h(this.maxWidth,this);this.ratio=1;this.bind()}a.prototype.maxWidth=function(){return Math.max(0,this.viewBean.width()-90)};a.prototype.bind=function(){return $(window).resize(function(a){return function(){return a.zoomYoutube(a.ratio)}}(this))};
a.prototype.zoom=function(a){var c;t=this.ratio=a;$("img.zoom.zoom-cover").width(230*(a+1)/2);c=$("img.zoom.zoom-cg");c.length&&(c.width(220*a),$("section.cg .images:visible").masonry());return this.zoomYoutube(a)};a.prototype.youtubeWidth=function(a){return Math.min(220*(null!=a?a:this.ratio),this.maxWidth())};a.prototype.zoomYoutube=function(a){return $(".youtube:not(.iframe)").width(this.youtubeWidth*a)};a.prototype.youtubeFrameWidth=function(){return Math.min(480*this.ratio,Math.max(480,this.maxWidth()))};
a.prototype.youtubeFrameHeight=function(){return 9*this.youtubeFrameWidth()/16};return a}();ea=function(){var a;k("bindToolbar: enter");this.zoomer=new F(this.viewBean);a=new ZoomSlider(function(a){return function(c){return a.zoomer.zoom(1+2*c)}}(this));new Toolbar(this.viewBean,{width:60,height:320,move:a.reloadOffset});$("#toolbar .btn.btn-annot").click(function(){var a;$(this).toggleClass("btn-default").toggleClass("btn-success");a=this.dataset.annot;$(document.body).toggleClass(a);return n()});
return k("bindToolbar: leave")};T=function(){return $.fn.annotate=function(){this.each(function(){return window.annotate(this)});return this}};n=function(){if($(document.body).is("[class |= annot-opt]"))return $(".annot:not(.annot-root)").annotate()};P=function(a){return twttr.widgets.createTimeline(a.id,a.el,a.callback,a.options)};ta=function(a){return HAML_SAMPLE_IMAGE({url:a})};ka=function(a){a=gameBean.getSampleImages(a);if(!a)return[0,""];a=a.split(",");return[a.length,a.map(ta).join("")]};va=
function(a){null==a.date&&(a.date="");a.img=gameBean.getYouTubeImageUrl(a.vid,!0);return HAML_VIDEO(a)};pa=function(){return JSON.parse(gameBean.getVideos()).map(va).join("")};oa=function(a){return'<iframe width="480" height="360" src="http://youtube.com/embed/'+a+'" frameborder="0" allowfullscreen />'};ma=function(a){return HAML_SETTINGS({file:a})};na=function(a){var b,c,d;c=0;for(d=a.length;c<d;c++)b=a[c],b.langName=util.getLangName(b.lang)||"*",b.userAvatar&&(b.userAvatarUrl=util.getAvatarUrl(b.userAvatar));
return HAML_USERS({users:a})};ja=function(a){return"scape"===a?la():gameBean.getReview(a)};s=function(a){return null!=a?a.replace(/\n/g,"<br/>"):void 0};p=0;ua=function(a){var b,c,d,f;++p;try{return c=0,a.okazu_tokuten&&0>a.okazu_tokuten&&-10<a.okazu_tokuten&&(c=-a.okazu_tokuten),b=d="",a.memo&&(b=s(a.memo),200<a.memo.length&&(d=s(a.memo.slice(0,201)+" \u2026\u2026"))),HAML_SCAPE_REVIEW({count:p,user:a.uid,userUrl:"http://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/user_infomation.php?user="+
a.uid,date:a.timestamp,netabare:a.netabare,score:a.tokuten||0,ecchiScore:c,title:s(a.hitokoto),content:b,contentLength:null!=(f=a.memo)?f.length:void 0,lessContent:d})}catch(e){return k(e),'<div class="entry entry-empty"/>'}};z=function(a,b){var c,d;return(c=gameBean.getScapeReviews(a,b))?(c=JSON.parse(c),d=c.map(ua).join(""),[d,c.length]):["",0]};la=function(){var a,b;a=z(0,10);b=a[0];a=a[1];if(b)return HAML_SCAPE_REVIEWLIST({entries:b,empty:10>a})};ca=function(){return $.fn.spin.presets.section=
{left:"-8px",length:4,radius:4,lines:12,width:1}};da=function(){aa();ba();ga();fa();return ha()};ba=function(){var a,b,c,d;c=$("section.settings");a=c.find(".contents");d=c.find(".spin");b=c.find(".msg");return c.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(c,e){if(e){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");d.spin("section");return rest.forum.query("game",{data:{id:GAME_ID,select:"file"},error:function(){d.spin(!1);a.removeClass("rendered");
return b.addClass("text-danger").text("("+tr("Internet error")+")")},success:function(c){d.spin(!1);return c.file?(b.empty(),c=ma(c.file),a.hide().html(c).fadeIn()):b.removeClass("text-danger").text(" ("+tr("Empty")+")")}})}return a.fadeOut()})};ga=function(){var a,b,c,d;c=$("section.users");a=c.find(".contents");d=c.find(".spin");b=c.find(".msg");return c.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(c,e){if(e){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");
d.spin("section");return rest.forum.query("game",{data:{id:GAME_ID,select:"users"},error:function(){d.spin(!1);a.removeClass("rendered");return b.addClass("text-danger").text("("+tr("Internet error")+")")},success:function(c){d.spin(!1);return(c=c.users||c.subs)?(b.empty(),c=na(c),a.hide().html(c).fadeIn().find("a.user-link").click(function(){var a;a=$(this).closest(".user").data("name");return mainBean.showUser(a)})):b.removeClass("text-danger").text(" ("+tr("Empty")+")")}})}return a.fadeOut()})};
m=[];S=function(a){return _.findWhere(m,{id:a})};A=function(){return(m.length-0)%20};aa=function(){var a,b,c,d,f,e,g;f=$("section.stats");b=f.find(".contents");c=b.find(".footer");a=b.find(".topics");e=f.find(".spin");d=f.find(".msg");f.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(f,wa){if(wa){if(b.hasClass("rendered"))return b.fadeIn();b.show().addClass("rendered");e.spin("section");return rest.forum.list("topic",{data:{type:"review",subjectId:GAME_ID,subjectType:"game",
sort:"updateTime",asc:!1,limit:20,complete:!0},error:function(){e.spin(!1);b.removeClass("rendered");return d.addClass("text-danger").text("("+tr("Internet error")+")")},success:function(b){e.spin(!1);return b.length?(d.empty(),b=y(b),a.hide().html(b).fadeIn(),A()?c.html(HTML_NOMORE):(c.html(HTML_MORE),c.find(".btn-more").click(g)),u()):d.removeClass("text-danger").text(" ("+tr("Empty")+")")}})}return b.fadeOut()});return g=function(){return rest.forum.list("topic",{data:{type:"review",subjectId:GAME_ID,
subjectType:"game",sort:"updateTime",asc:!1,first:m.length,limit:20,complete:!0},error:function(){e.spin(!1);return growl.warn(tr("Internet error"))},success:function(b){e.spin(!1);b.length&&(b=y(b),a.append(b));A()&&c.html(HTML_NOMORE);return u()}})}};y=function(a){m.push.apply(m,a);try{return a.map(sa).join("")}catch(b){return k(b),'<div class="entry entry-empty"/>'}};sa=function(a){return HAML_REVIEW_TOPIC({id:a.id,userName:a.userName,userStyle:a.userColor?"color:"+a.userColor:"",lang:util.getLangName(a.lang),
userAvatarUrl:util.getAvatarUrl(a.userAvatar),content:util.renderContent(a.content),createTime:util.formatDate(a.createTime),updateTime:a.updateTime>a.createTime?util.formatDate(a.updateTime):"",image:a.image?{title:a.image.title,url:util.getImageUrl(a.image)}:null,scores:a.scores,likeCount:a.likeCount||0,dislikeCount:a.dislikeCount||0,postCount:a.postCount})};u=function(){return $(".topic.topic-new").each(function(){var a,b,c,d;b=$(this).removeClass("topic-new");d=b.data("id");c=S(d);a=b.find("> .right > .footer");
a.find(".btn-edit").click(function(){c&&editTopic(c);return!1});a.find(".btn-reply").click(function(){replyTopic(d);return!1});a.find(".btn-posts").click(function(){$(this).remove();ia(d);return!1});(null!=c&&c.likeCount||null!=c&&c.dislikeCount)&&a.find(".like-group").removeClass("fade-in");a.find(".btn.like").click(function(){var b,e,g,l;c&&c.userName!==USER_NAME&&(b=a.find(".btn.dislike.selected"),b.length&&(b.removeClass("selected"),g=b.find(".value"),g.text(-1+Number(g.text()))),e=$(this),e.parent(".like-group").removeClass("fade-in"),
l=e.hasClass("selected"),ticket.update({data:{login:USER_NAME,password:USER_PASSWORD,targetType:"topic",targetId:d,type:"like",value:l?0:1},success:function(a){return function(){e.toggleClass("selected");g=e.find(".value");return g.text((l?-1:1)+Number(g.text()))}}(this)}));return!1});return a.find(".btn.dislike").click(function(){var b,e,g,l;c&&c.userName!==USER_NAME&&(b=a.find(".btn.like.selected"),b.length&&(b.removeClass("selected"),g=b.find(".value"),g.text(-1+Number(g.text()))),e=$(this),e.parent(".like-group").removeClass("fade-in"),
l=e.hasClass("selected"),ticket.update({data:{login:USER_NAME,password:USER_PASSWORD,targetType:"topic",targetId:d,type:"like",value:l?0:-1},success:function(a){return function(){e.toggleClass("selected");g=e.find(".value");return g.text((l?-1:1)+Number(g.text()))}}(this)}));return!1})})};ia=function(a){return rest.forum.list("post",{data:{topic:a,sort:"createTime",asc:!0,limit:E},error:function(){return growl.warn(tr("Internet error"))},success:function(b){return b.length?G(a,b):growl.warn(tr("Internet error"))}})};
E=20;q=[];x=function(a){return HAML_POST({id:a.id,type:a.type,userName:a.userName,userStyle:a.userColor?"color:"+a.userColor:"",lang:util.getLangName(a.lang),userAvatarUrl:util.getAvatarUrl(a.userAvatar),content:util.renderContent(a.content),createTime:util.formatDate(a.createTime),updateTime:a.updateTime>a.createTime?util.formatDate(a.updateTime):"",image:a.image?{title:a.image.title,url:util.getImageUrl(a.image)}:null,likeCount:a.likeCount||0,dislikeCount:a.dislikeCount||0})};C=function(a){return $(".post[data-id="+
a+"]")};R=function(a){return _.findWhere(q,{id:a})};Q=function(a){return postEditBean.editPost(JSON.stringify(a))};qa=function(a){return postInputBean.replyPost(a)};J=function(){return $(".post.post-new").each(function(){var a,b,c,d;b=$(this).removeClass("post-new");d=b.data("id");c=R(d);a=b.find("> .right > .footer");a.find(".btn-edit").click(function(){c&&Q(c);return!1});a.find(".btn-reply").click(function(){qa(d);return!1});(null!=c&&c.likeCount||null!=c&&c.dislikeCount)&&a.find(".like-group").removeClass("fade-in");
a.find(".btn.like").click(function(){var f,e,g;c&&c.userName!==USER_NAME&&(f=a.find(".btn.dislike.selected"),f.length&&(f.removeClass("selected"),e=f.find(".value"),e.text(-1+Number(e.text()))),b=$(this),b.parent(".like-group").removeClass("fade-in"),g=b.hasClass("selected"),ticket.update({data:{login:USER_NAME,password:USER_PASSWORD,targetType:"post",targetId:d,type:"like",value:g?0:1},success:function(a){return function(){b.toggleClass("selected");e=b.find(".value");return e.text((g?-1:1)+Number(e.text()))}}(this)}));
return!1});return a.find(".btn.dislike").click(function(){var f,e,g;c&&c.userName!==USER_NAME&&(f=a.find(".btn.like.selected"),f.length&&(f.removeClass("selected"),e=f.find(".value"),e.text(-1+Number(e.text()))),b=$(this),b.parent(".like-group").removeClass("fade-in"),g=b.hasClass("selected"),ticket.update({data:{login:USER_NAME,password:USER_PASSWORD,targetType:"post",targetId:d,type:"like",value:g?0:-1},success:function(a){return function(){b.toggleClass("selected");e=b.find(".value");return e.text((g?
-1:1)+Number(e.text()))}}(this)}));return!1})})};G=function(a,b){var c,d,f,e,g,l;q.push.apply(q,b);d=function(){var a,c,e;e=[];a=0;for(c=b.length;a<c;a++)f=b[a],"post"===f.type&&e.push(x(f));return e}().join("");$(".topic[data-id="+a+"] > .reply").append(d);e=function(){var a,c,e;e=[];a=0;for(c=b.length;a<c;a++)f=b[a],"reply"===f.type&&e.push(f);return e}();if(e.length)for(e=_.sortBy(e,function(a){return a.createTime}),g=0,l=e.length;g<l;g++)f=e[g],c=C(f.replyId),c.length?(d=x(f),c.children(".reply").append(d)):
k("addPosts: error: post lost");return J()};fa=function(){var a,b;b=$("section.twitter");a=b.find(".widgets");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,d){var f,e,g,l,h,k;if(window.twttr)if(d){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");if(f=gameBean.getTwitterWidgets()){h=f.split(",");k=[];g=0;for(l=h.length;g<l;g++)e=h[g],f=document.createElement("div"),f.className="timeline",a.append(f),k.push(P({id:e,el:f,options:{lang:i18nBean.lang(),
width:480,height:500,chrome:"transparent noborders noheader",showReplies:!0}}));return k}}else return a.fadeOut()})};ha=function(){var a,b,c;b=$("section.youtube");a=b.find(".videos");c=b.find(".spin");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,f){if(f)return c.addClass("spin-running").spin("section"),a.hide().html(pa()).fadeIn().imagesLoaded(function(){return c.removeClass("spin-running").spin(!1)}),N();a.empty();if(c.hasClass("spin-running"))return c.removeClass("spin-running").spin(!1)})};
N=function(){var a;a=$("section.youtube .video");if(a.length)return a.find(".image > img").load(function(){var a;if(120===this.naturalWidth)return a=$(this),a=a.closest(".video").data("id"),this.src=a=gameBean.getYouTubeImageUrl(a,!1)}),a.find(".btn-dl").click(function(){var a;a=$(this).closest(".video").data("id");youtubeBean.get(a);return!1}),a.find(".tts").click(function(){return ttsBean.speak(this.dataset.text)}),a.find("a.title,img,button.close").click(function(){var a,c;c=$(this).closest(".video");
c.find("img");a=c.find("iframe");a.length?(c.removeClass("play"),a.remove()):(c.addClass("play"),a=c.data("id"),a=oa(a),c.find(".iframe").html(a));return!1})};X=function(){U();V();W();return Z()};W=function(){var a,b,c,d;b=$("section.descriptions");a=b.find(".contents");c=b.find(".spin");d=new r(c);return b.find(".nav.nav-pills > li > a").click(function(){var c,b,g;b=$(this).parent("li");b.hasClass("active")||(c=b.parent("ul").children("li.active").removeClass("active").data("type"),b.addClass("active"),
b=b.data("type"),c&&a.children("."+c).hide(),b&&(c=a.children("."+b),c.length?c.fadeIn():(d.inc(),g=gameBean.getDescription(b),c=document.createElement("div"),c.className=b+" description annot",c.innerHTML=g,$(c).hide().appendTo(a).fadeIn().imagesLoaded(function(){return d.dec()}).find("a:not([title])").each(function(){return this.setAttribute("title",this.href)}),n())));return!1})};V=function(){var a,b,c,d;b=$("section.characters");a=b.find(".contents");c=b.find(".spin");d=new r(c);return b.find(".nav.nav-pills > li > a").click(function(){var c,
b,g;b=$(this).parent("li");b.hasClass("active")||(c=b.parent("ul").children("li.active").removeClass("active").data("type"),b.addClass("active"),b=b.data("type"),c&&a.children("."+c).hide(),b&&(c=a.children("."+b),c.length?c.fadeIn():(d.inc(),g=gameBean.getCharacterDescription(b),c=document.createElement("div"),c.className=b+" character annot",c.innerHTML=g,$(c).hide().appendTo(a).fadeIn().imagesLoaded(function(){return d.dec()}).find("a:not([title])").each(function(){return this.setAttribute("title",
this.href)}),n())));return!1})};Z=function(){var a,b,c;b=$("section.reviews");a=b.find(".contents");c=b.find(".spin");return b.find(".nav.nav-pills > li > a").click(function(){var b,f,e,g;f=$(this).parent("li");f.hasClass("active")||(b=f.parent("ul").children("li.active").removeClass("active").data("type"),f.addClass("active"),f=f.data("type"),b&&a.children("."+b).hide(),f&&(b=a.children("."+f),b.length?b.fadeIn():(c.spin("section"),g=ja(f),e=document.createElement("div"),b=f+" review","scape"!==
f&&(b+=" annot"),e.className=b,e.innerHTML=g||HTML_EMPTY,$(e).hide().appendTo(a).fadeIn(),v(),c.spin(!1),"scape"===f&&g&&K(c),n())));return!1})};v=function(){return $(".scape .entry.entry-new").each(function(){return $(this).removeClass("entry-new").find(".btn-more").click(function(){var a,b,c,d;d=$(this);c=d.closest(".entry");b=c.find(".content.content-more");a=c.find(".content.content-less");b.toggleClass("inactive");a.toggleClass("inactive");a=c.data("content-length");b=b.hasClass("inactive");
d.text(""+tr(b?"More":"Less")+" ("+a+")");return c.effect("highlight",1E3)})})};B=function(){return(p-10)%20};K=function(a){return $(".scape .footer .btn-more").click(function(){var b,c,d,f;c=$(this);b=c.closest(".scape").find(".list");d=!1;B()||(a.spin("section"),f=z(p,20),f=f[0],a.spin(!1),f&&($(f).hide().appendTo(b).fadeIn(),v(),n(),d=B()));d&&c.replaceWith(HTML_NOMORE);return!1})};U=function(){var a,b,c,d;b=$("section.cg");a=b.find(".contents");c=b.find(".spin");d=new r(c);return b.find(".nav.nav-pills > li > a").click(function(){var b,
c,g;c=$(this).parent("li");c.hasClass("active")||(b=c.parent("ul").children("li.active").removeClass("active").data("type"),c.addClass("active"),c=c.data("type"),b&&a.children("."+b).hide(),c&&(b=a.children("."+c),b.length?b.fadeIn().masonry():(g=ka(c),b=g[0],g=g[1],d.inc(b),b=document.createElement("div"),b.className=c+" images",b.innerHTML=g,function(b){var c;c=null;return b.hide().appendTo(a).fadeIn().masonry({itemSelector:"img",isFitWidth:!0}).find("img").load(function(){d.dec();~this.src.indexOf("pics.dmm.")&&
90===this.naturalWidth&&122===this.naturalHeight?(null==c&&(c=new D(b)),c.pause(),b.masonry("remove",this)):$(this).width(220*t);return b.masonry()})}($(b)))));return!1})};Y=function(){$.fn.raty.defaults.path=JQUERY_RATY_PATH;$.fn.raty.defaults.hints=["","","","",""];$.fn.raty.round={down:.5,up:1,full:1};return $(".raty").each(function(){var a,b,c;c=this.dataset.sum;b=this.dataset.count;a=$(this);a.raty({readOnly:!0,half:!0,score:0<b?c/b/2:0});if(0<b)return c/=b,a.closest(".score-row").find(".score-label").html(""+
sprintf("%.1f",c)+"&times;"+b)})};H=function(){$(".btn-dl-img").click(function(){gameBean.saveImages();return!1});return $(".btn-dl-yt").click(function(){gameBean.saveVideos();return!1})};M=function(){return $(".tts").click(function(){return ttsBean.speak(this.dataset.text)})};L=function(){return $("a.search").click(function(){var a;a=this.dataset.text||$.trim(this.textContent);return gameBean.search(a)})};I=function(){return $(".draggable").draggable().find("button.close").click(function(){return $(this).closest(".draggable").fadeOut()})};
w=function(){if(null==this.gameBean)return k("init: wait"),setTimeout(w,100);k("init: enter");moment.locale("ja");this.GAME_ID=$(".game").data("id");ca();O();ea();da();X();Y();T();H();M();L();I();return k("init: leave")};$(function(){return w()})}).call(this);
