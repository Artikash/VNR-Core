(function(){var k,m,c,h,n,p,e=function(b,a){return function(){return b.apply(a,arguments)}};c=function(){};this.bindAmazon=function(){var b;c("bindAmazon: enter");b=$("iframe.amazon");b.load(function(){var a,l;l=$(this);a=l.contents().find("body");return a.html()?(a.css("background-color","transparent").find(".crIFrame").css("margin-left","-0.8em"),a.find(".crIFrameLogo,.crIframeHeaderTitle").remove()):l.remove()});$(window).on("scroll resize",function(){var a;a=this.viewBean.width();return b.width(a-
74)});$("iframe.amazon").error(function(){return $(this).remove()});return c("bindAmazon: leave")};this.bindYoutube=function(){var b,a;c("bindYoutube: enter");a=function(a){var f,d;d=Math.round(zoomer.youtubeFrameWidth());f=Math.round(zoomer.youtubeFrameHeight());return'<iframe width="'+d+'" height="'+f+'" src="http://youtube.com/embed/'+a+'" frameborder="0" allowfullscreen />'};$("a.badge").click(function(){return this.classList.add("badge-info")});$("a.label,a .label").click(function(){return this.classList.add("label-info")});
b=$("body").data("id");$(".btn-dl-img").click(function(){bean.getimg(b);return!1});$(".btn-dl-yt").click(function(){bean.getyt(b);return!1});MAINLAND?$(".youtube .btn-dl,.youtube .btn-play,.youtube .label,.youtube img").click(function(){var a;a=$(this).closest(".youtube").data("id");youtubeBean.get(a);return!1}):($(".youtube .btn-dl").click(function(){var a;a=$(this).closest(".youtube").data("id");youtubeBean.get(a);return!1}),$(".youtube .btn-play,.youtube .label,.youtube img").click(function(){var b,
f,d,c,g;g=$(this).closest(".youtube");c=g.find(".label");d=g.find("img");f=g.find("iframe");b=g.find(".btn-play");f.length?(b.prop("title","\u518d\u751f").find(".icon-stop").removeClass("icon-stop").addClass("icon-play"),c.removeClass("label-info").removeClass("label-success"),f.remove(),f=zoomer.youtubeWidth(),b="",g.removeClass("iframe").width(f).height(b),d.show()):(b.prop("title","\u505c\u6b62").find(".icon-play").removeClass("icon-play").addClass("icon-stop"),c.removeClass("label-info").addClass("label-success"),
d.hide(),f="100%",b=zoomer.youtubeFrameHeight()+30,g.addClass("iframe").width(f).height(b),d=g.data("id"),b=a(d),g.append(b));return!1}));return c("bindYoutube: leave")};m=function(){function b(a){this.viewBean=a;this.youtubeFrameHeight=e(this.youtubeFrameHeight,this);this.youtubeFrameWidth=e(this.youtubeFrameWidth,this);this.zoomYoutube=e(this.zoomYoutube,this);this.youtubeWidth=e(this.youtubeWidth,this);this.zoom=e(this.zoom,this);this.bind=e(this.bind,this);this.maxWidth=e(this.maxWidth,this);
this.ratio=1;this.bind()}b.prototype.maxWidth=function(){return Math.max(0,this.viewBean.width()-90)};b.prototype.bind=function(){return $(window).resize(function(a){return function(){return a.zoomYoutube(a.ratio)}}(this))};b.prototype.zoom=function(a){this.ratio=a;$(".chara").width(100*a);$(".cg").width(220*a);$(".cover").width(230*a);return this.zoomYoutube(a)};b.prototype.youtubeWidth=function(a){return Math.min(220*(null!=a?a:this.ratio),this.maxWidth())};b.prototype.zoomYoutube=function(a){return $(".youtube:not(.iframe)").width(this.youtubeWidth(a))};
b.prototype.youtubeFrameWidth=function(){return Math.min(480*this.ratio,Math.max(480,this.maxWidth()))};b.prototype.youtubeFrameHeight=function(){return 9*this.youtubeFrameWidth()/16};return b}();p=function(){var b;c("bindToolbar: enter");this.zoomer=new m(this.viewBean);b=new ZoomSlider(function(a){return function(b){return a.zoomer.zoom(1+2*b)}}(this));new Toolbar(this.viewBean,{width:60,height:244,move:b.reloadOffset});return c("bindToolbar: leave")};k=function(){function b(a,b,f){this.callback=
a;this.interval=null!=b?b:50;this.timerId=null!=f?f:0;this.trigger=e(this.trigger,this);this.schedule=e(this.schedule,this);this.active=e(this.active,this)}b.prototype.active=function(){return 0!==this.timerId};b.prototype.schedule=function(a,b){this.interval=a;this.callback=b;return this.timeId=setTimeout(this.trigger,this.interval)};b.prototype.trigger=function(){this.timerId&&(clearTimeout(this.timerId),this.timerId=0);return"function"===typeof this.callback?this.callback():void 0};return b}();
n=function(){var b,a,e;c("bindRuby: enter");e=new k;a=function(b,a,c){return e.schedule(c,function(){clipboardBean.text=a;return ttsBean.speak(a)})};b=function(a,b,c){var g,h,k;g=$(window);h=a.pageX-g.scrollLeft()+viewBean.x();k=a.pageY-g.scrollTop()+viewBean.y();return e.schedule(c,function(){clipboardBean.text=b;shioriBean.popup(b,h,k);return ttsBean.speak(b)})};$(".ruby ruby").dblclick(function(a){var d;if(d=$.trim($(this).find("rb").text()))return b(a,d,0)}).click(function(){var a;a=$.trim($(this).find("rb").text());
return viewBean.rehighlight(a)});$(".yomi").each(function(){var a;if(!this.title)return a=$.trim($(this).text()),this.title="\u8aad: "+yomiBean.toYomi(a)}).dblclick(function(a){var d;if(d=$.trim($(this).text()))return b(a,d,0)}).click(function(b){var d;if(d=$.trim($(this).text()))return a(b,d,150)});$(".ruby:not(.article),.ruby .sentence").click(function(b){var d;if(d=$.trim($(this).find("rb").text()))return a(b,d,150)}).hover(function(){var a,b;if(!this.title&&(a=$(this),!a.hasClass("pass")&&(a.addClass("pass"),
(b=$.trim(a.find("rb").text()))&&yakuBean.enabled()))){this.title="\u3061\u3087\u3063\u3068\u307e\u3063\u3066\u3066><";if(b=yakuBean.yaku(b))return this.title="\u8a33: "+b;this.title="";return a.removeClass("pass")}});return c("bindRuby: leave")};h=function(){if(null==this.bean)return c("init: wait"),setTimeout(h,100);c("init: enter");p();n();return c("init: leave")};$(function(){return h()})}).call(this);
