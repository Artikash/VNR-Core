(function(){var l,h,m,c,k,n,p,q,r,s,f=function(b,a){return function(){return b.apply(a,arguments)}};c=function(){};l=Haml('%a(href="#{url}" title="#{url}")\n  %img.img-rounded.zoom.zoom-cg(src="#{url}")');s=function(b){return l({url:b})};r=function(){return gameBean.getSampleImages().split(",").map(s).join("")};this.bindAmazon=function(){var b;c("bindAmazon: enter");b=$("iframe.amazon");b.load(function(){var a,b;b=$(this);a=b.contents().find("body");return a.html()?(a.css("background-color","transparent").find(".crIFrame").css("margin-left",
"-0.8em"),a.find(".crIFrameLogo,.crIframeHeaderTitle").remove()):b.remove()});$(window).on("scroll resize",function(){var a;a=this.viewBean.width();return b.width(a-74)});$("iframe.amazon").error(function(){return $(this).remove()});return c("bindAmazon: leave")};this.bindYoutube=function(){var b;c("bindYoutube: enter");b=function(a){var b,d;d=Math.round(zoomer.youtubeFrameWidth());b=Math.round(zoomer.youtubeFrameHeight());return'<iframe width="'+d+'" height="'+b+'" src="http://youtube.com/embed/'+
a+'" frameborder="0" allowfullscreen />'};$(".btn-dl-img").click(function(){gameBean.saveImages();return!1});$(".btn-dl-yt").click(function(){gameBean.saveVideos();return!1});MAINLAND?$(".youtube .btn-dl,.youtube .btn-play,.youtube .label,.youtube img").click(function(){var a;a=$(this).closest(".youtube").data("id");youtubeBean.get(a);return!1}):($(".youtube .btn-dl").click(function(){var a;a=$(this).closest(".youtube").data("id");youtubeBean.get(a);return!1}),$(".youtube .btn-play,.youtube .label,.youtube img").click(function(){var a,
g,d,c,e;e=$(this).closest(".youtube");c=e.find(".label");d=e.find("img");g=e.find("iframe");a=e.find(".btn-play");g.length?(a.prop("title","\u518d\u751f").find(".fa-stop").removeClass("fa-stop").addClass("fa-play"),c.removeClass("label-info").removeClass("label-success"),g.remove(),g=zoomer.youtubeWidth(),a="",e.removeClass("iframe").width(g).height(a),d.show()):(a.prop("title","\u505c\u6b62").find(".fa-play").removeClass("fa-play").addClass("fa-stop"),c.removeClass("label-info").addClass("label-success"),
d.hide(),g="100%",a=zoomer.youtubeFrameHeight()+30,e.addClass("iframe").width(g).height(a),d=e.data("id"),a=b(d),e.append(a));return!1}));return c("bindYoutube: leave")};h=1;m=function(){function b(a){this.viewBean=a;this.youtubeFrameHeight=f(this.youtubeFrameHeight,this);this.youtubeFrameWidth=f(this.youtubeFrameWidth,this);this.zoomYoutube=f(this.zoomYoutube,this);this.youtubeWidth=f(this.youtubeWidth,this);this.zoom=f(this.zoom,this);this.bind=f(this.bind,this);this.maxWidth=f(this.maxWidth,this);
this.ratio=1;this.bind()}b.prototype.maxWidth=function(){return Math.max(0,this.viewBean.width()-90)};b.prototype.bind=function(){return $(window).resize(function(a){return function(){return a.zoomYoutube(a.ratio)}}(this))};b.prototype.zoom=function(a){var b;h=this.ratio=a;$("img.zoom.zoom-cover").width(230*(a+1)/2);b=$("img.zoom.zoom-cg");b.length&&(b.width(220*a),$("section.cg .images").masonry());return this.zoomYoutube(a)};b.prototype.youtubeWidth=function(a){return Math.min(220*(null!=a?a:this.ratio),
this.maxWidth())};b.prototype.zoomYoutube=function(a){return $(".youtube:not(.iframe)").width(this.youtubeWidth*a)};b.prototype.youtubeFrameWidth=function(){return Math.min(480*this.ratio,Math.max(480,this.maxWidth()))};b.prototype.youtubeFrameHeight=function(){return 9*this.youtubeFrameWidth()/16};return b}();q=function(){var b;c("bindToolbar: enter");this.zoomer=new m(this.viewBean);b=new ZoomSlider(function(a){return function(b){return a.zoomer.zoom(1+2*b)}}(this));new Toolbar(this.viewBean,{width:60,
height:244,move:b.reloadOffset});return c("bindToolbar: leave")};p=function(){c("bindRuby: enter");$.fn.inject=function(){return this.each(function(){return window.injectruby(this)})};$(".ruby").inject();return c("bindRuby: leave")};n=function(){return function(){var b;b=$("section.cg");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(a,c){var d;d=b.find(".images");return c?d.hasClass("loaded")?d.fadeIn():d.hide().html(r()).addClass("loaded").fadeIn().masonry({itemSelector:"img",
isFitWidth:!0}).imagesLoaded(function(){d.find("img").width(220*h);return d.masonry()}):d.fadeOut()})}()};k=function(){if(null==this.gameBean)return c("init: wait"),setTimeout(k,100);c("init: enter");q();n();p();return c("init: leave")};$(function(){return k()})}).call(this);
