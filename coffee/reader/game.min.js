(function(){var m,n,h,p,q,r,s,t,u,v,w,g,k,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,e=function(a,b){return function(){return a.apply(b,arguments)}};g=function(){};O=function(){return function(a,b,c){c.prototype=a.prototype;c=new c;a=a.apply(c,b);return Object(a)===a?a:c}(choco.Timer,arguments,function(){})};this.tr=function(a){return i18nBean.tr(a)};v=function(){this.HTML_EMPTY=Haml.render(".empty "+tr("Empty"));this.HAML_SAMPLE_IMAGE=Haml('%a(href="#{url}" title="#{url}")\n  %img.img-rounded.zoom.zoom-cg(src="#{url}")');
this.HAML_VIDEO=Haml(('.video(data-id="${vid}")\n  .header\n    %a.tts(role="button" data-text="${title}" title="TTS")\n      %span.fa.fa-volume-down\n    %a.title.cursor-pointer(title="'+tr("Play")+'") = title\n    :if date\n      .date = date\n    .toolbar.pull-right\n      %button.close(type="button" title="'+tr("Close")+'") &times;\n      %a.btn.btn-link.btn-xs(role="button" href="http://youtube.com/watch?v=${vid}" title="http://youtube.com/watch?v=${vid}")\n        %span.fa.fa-external-link\n  .image\n    %img.img-rounded(src="${img}" title="${title} ${date}")\n  .iframe').replace(/\$/g,
"#"));this.HAML_SETTINGS=Haml(".body.form-horizontal\n  :if file.encoding\n    .row.encoding\n      %label.control-label.col-xs-2 = tr('Encoding')\n      .form-control-static.col-xs-10 = file.encoding.toUpperCase()\n  :if file.threads\n    :if file.threads.scene\n      .row.thread\n        %label.control-label.col-xs-2 \u5bfe\u8a71\n        .form-control-static.col-xs-10\n          = file.threads.scene.name\n          = ' '\n          = file.threads.scene.sig.toString(16)\n    :if file.threads.name\n      .row.thread\n        %label.control-label.col-xs-2 \u540d\u524d\n        .form-control-static.col-xs-10\n          = file.threads.name.name\n          = ' '\n          = file.threads.name.sig.toString(16)\n  .row.hcode\n    %label.control-label.col-xs-2 = tr('H-code')\n    .form-control-static.col-xs-10\n      :if file.hook\n        = file.hook.text\n        :if file.hook.locked\n          %b.text-info = ' (' + tr('Locked') + ')'\n          %i.text-muted.text-xs\n            = ' -- '\n            = tr('This h-code is definite correct and not allowed to change')\n      :else\n        %span.text-muted = tr('Not specified')");
return this.HAML_USERS=Haml(':for it in users\n  .user\n    :if it.userAvatar\n      %a.user(href="#{it.url}" title="#{it.url}")\n        %img.img-circle.avatar(src="http://media.getchute.com/media/#{it.userAvatar}/128x128")\n    .header\n      %a.user(href="#{it.url}") @#{it.userName}\n    .footer #{it.count} / #{it.lang}')};w=function(a){return twttr.widgets.createTimeline(a.id,a.el,a.callback,a.options)};P=function(a){return HAML_SAMPLE_IMAGE({url:a})};J=function(a){a=gameBean.getSampleImages(a).split(",");
return[a.length,a.map(P).join("")]};Q=function(a){null==a.date&&(a.date="");a.img=gameBean.getYouTubeImageUrl(a.vid,!0);return HAML_VIDEO(a)};N=function(){return JSON.parse(gameBean.getVideos()).map(Q).join("")};M=function(a){return'<iframe width="480" height="360" src="http://youtube.com/embed/'+a+'" frameborder="0" allowfullscreen />'};K=function(a){return HAML_SETTINGS({file:a})};L=function(a){var b,c,d,f;c=0;for(d=a.length;c<d;c++)b=a[c],b.url="http://sakuradite.com/user/"+b.userName,b.lang=(null!=
(f=b.lang)?f.slice(0,2):void 0)||"*";return HAML_USERS({users:a})};this.initAmazonReview=function(){var a;g("initAmazonReview: enter");a=$("iframe.amazon");a.load(function(){var a,c;c=$(this);a=c.contents().find("body");return a.html()?(a.css("background-color","transparent").find(".crIFrame").css("margin-left","-0.8em"),a.find(".crIFrameLogo,.crIframeHeaderTitle").remove()):c.remove()});$(window).on("scroll resize",function(){var b;b=this.viewBean.width();return a.width(b-74)});$("iframe.amazon").error(function(){return $(this).remove()});
return g("initAmazonReview: leave")};h=1;p=function(){function a(a){this.viewBean=a;this.youtubeFrameHeight=e(this.youtubeFrameHeight,this);this.youtubeFrameWidth=e(this.youtubeFrameWidth,this);this.zoomYoutube=e(this.zoomYoutube,this);this.youtubeWidth=e(this.youtubeWidth,this);this.zoom=e(this.zoom,this);this.bind=e(this.bind,this);this.maxWidth=e(this.maxWidth,this);this.ratio=1;this.bind()}a.prototype.maxWidth=function(){return Math.max(0,this.viewBean.width()-90)};a.prototype.bind=function(){return $(window).resize(function(a){return function(){return a.zoomYoutube(a.ratio)}}(this))};
a.prototype.zoom=function(a){var c;h=this.ratio=a;$("img.zoom.zoom-cover").width(230*(a+1)/2);c=$("img.zoom.zoom-cg");c.length&&(c.width(220*a),$("section.cg .images:visible").masonry());return this.zoomYoutube(a)};a.prototype.youtubeWidth=function(a){return Math.min(220*(null!=a?a:this.ratio),this.maxWidth())};a.prototype.zoomYoutube=function(a){return $(".youtube:not(.iframe)").width(this.youtubeWidth*a)};a.prototype.youtubeFrameWidth=function(){return Math.min(480*this.ratio,Math.max(480,this.maxWidth()))};
a.prototype.youtubeFrameHeight=function(){return 9*this.youtubeFrameWidth()/16};return a}();F=function(){var a;g("bindToolbar: enter");this.zoomer=new p(this.viewBean);a=new ZoomSlider(function(a){return function(c){return a.zoomer.zoom(1+2*c)}}(this));new Toolbar(this.viewBean,{width:60,height:244,move:a.reloadOffset});return g("bindToolbar: leave")};B=function(){g("bindRuby: enter");$.fn.inject=function(){return this.each(function(){return window.injectruby(this)})};$(".ruby").inject();return g("bindRuby: leave")};
D=function(){return $.fn.spin.presets.section={left:"-8px",lines:8,length:4,width:2,radius:4}};E=function(){C();H();G();return I()};C=function(){var a,b,c;b=$("section.settings");a=b.find(".contents");c=b.find(".spin");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,f){if(f){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");c.spin("section");return rest.forum.query("game",{data:{id:GAME_ID,select:"file",agent:"vnr"},error:function(){c.spin(!1);
return a.removeClass("rendered")},success:function(b){c.spin(!1);b=b.file?K(b.file):HTML_EMPTY;return a.hide().html(b).fadeIn()}})}return a.fadeOut()})};H=function(){var a,b,c;b=$("section.users");a=b.find(".contents");c=b.find(".spin");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,f){if(f){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");c.spin("section");return rest.forum.query("game",{data:{id:GAME_ID,select:"users",agent:"vnr"},
error:function(){c.spin(!1);return a.removeClass("rendered")},success:function(b){c.spin(!1);b=(b=b.users||b.subs)?L(b):HTML_EMPTY;return a.hide().html(b).fadeIn()}})}return a.fadeOut()})};G=function(){var a,b;b=$("section.twitter");a=b.find(".widgets");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,d){var f,R,e,g,l,h;if(window.twttr)if(d){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");if(f=gameBean.getTwitterWidgets()){l=f.split(",");
h=[];e=0;for(g=l.length;e<g;e++)R=l[e],f=document.createElement("div"),f.className="timeline",a.append(f),h.push(w({id:R,el:f,options:{lang:i18nBean.lang(),width:480,height:500,chrome:"transparent noborders noheader",showReplies:!0}}));return h}}else return a.fadeOut()})};I=function(){var a,b;b=$("section.youtube");a=b.find(".videos");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,d){return d?(a.hide().html(N()).fadeIn(),u()):a.empty()})};u=function(){var a;
a=$("section.youtube .video");if(a.length)return a.find(".image > img").load(function(){var a;if(120===this.naturalWidth)return a=$(this),a=a.closest(".video").data("id"),this.src=a=gameBean.getYouTubeImageUrl(a,!1)}),a.find(".tts").click(function(){return ttsBean.speak(this.dataset.text)}),a.find("a.title,img,button.close").click(function(){var a,c;c=$(this).closest(".video");c.find("img");a=c.find("iframe");a.length?(c.removeClass("play"),a.remove()):(c.addClass("play"),a=c.data("id"),a=M(a),c.find(".iframe").html(a));
return!1})};A=function(){x();z();return y()};z=function(){var a,b;b=$("section.descriptions");a=b.find(".contents");return b.find(".nav.nav-pills > li > a").click(function(){var b,d,f;d=$(this).parent("li");d.hasClass("active")||(b=d.parent("ul").children("li.active").removeClass("active").data("type"),d.addClass("active"),d=d.data("type"),b&&a.children("."+b).hide(),d&&(b=a.children("."+d),b.length?b.fadeIn():(f=gameBean.getDescription(d),b=document.createElement("div"),b.className=d+" description",
b.innerHTML=f,$(b).hide().appendTo(a).fadeIn().find("a:not([title])").each(function(){return this.setAttribute("title",this.href)}))));return!1})};y=function(){var a,b;b=$("section.characters");a=b.find(".contents");return b.find(".nav.nav-pills > li > a").click(function(){var b,d,f;d=$(this).parent("li");d.hasClass("active")||(b=d.parent("ul").children("li.active").removeClass("active").data("type"),d.addClass("active"),d=d.data("type"),b&&a.children("."+b).hide(),d&&(b=a.children("."+d),b.length?
b.fadeIn():(f=gameBean.getCharacterDescription(d),b=document.createElement("div"),b.className=d+" character",b.innerHTML=f,$(b).hide().appendTo(a).fadeIn().find("a:not([title])").each(function(){return this.setAttribute("title",this.href)}))));return!1})};m=function(){function a(a,c){this.$container=a;this.paused=null!=c?c:!1;this.resume=e(this.resume,this);this.pause=e(this.pause,this);this.timer=O(600,this.pause)}a.prototype.pause=function(){this.paused||(this.paused=!0,this.$container.masonry({isAnimated:!1,
transitionDuration:0}));return this.timer.start()};a.prototype.resume=function(){this.timer.stop();if(this.paused)return this.paused=!1,this.$container.masonry({isAnimated:!0,transitionDuration:400})};return a}();n=function(){function a(a,c,d){this.$el=a;this.count=null!=c?c:0;this.preset=null!=d?d:"section";this.dec=e(this.dec,this);this.inc=e(this.inc,this);this.count&&this.$el.spin("section")}a.prototype.inc=function(a){null==a&&(a=1);if(0<a)return 0>=this.count&&this.$el.spin(this.preset),this.count+=
a};a.prototype.dec=function(a){null==a&&(a=1);if(0<a&&(this.count-=a,0>=this.count))return this.$el.spin(!1)};return a}();x=function(){var a,b,c,d;b=$("section.cg");a=b.find(".contents");c=b.find(".spin");d=new n(c);return b.find(".nav.nav-pills > li > a").click(function(){var b,c,e;c=$(this).parent("li");c.hasClass("active")||(b=c.parent("ul").children("li.active").removeClass("active").data("type"),c.addClass("active"),c=c.data("type"),b&&a.children("."+b).hide(),c&&(b=a.children("."+c),b.length?
b.fadeIn().masonry():(e=J(c),b=e[0],e=e[1],d.inc(b),b=document.createElement("div"),b.className=c+" images",b.innerHTML=e,function(b){var c;c=null;return b.hide().appendTo(a).fadeIn().masonry({itemSelector:"img",isFitWidth:!0}).find("img").load(function(){d.dec();~this.src.indexOf("pics.dmm.")&&90===this.naturalWidth&&122===this.naturalHeight?(null==c&&(c=new m(b)),c.pause(),b.masonry("remove",this)):this.width=220*h;return b.masonry()})}($(b)))));return!1})};q=function(){$(".btn-dl-img").click(function(){gameBean.saveImages();
return!1});return $(".btn-dl-yt").click(function(){gameBean.saveVideos();return!1})};t=function(){return $(".tts").click(function(){return ttsBean.speak(this.dataset.text)})};s=function(){return $("a.search").click(function(){var a;a=this.dataset.text||$.trim(this.textContent);return gameBean.search(a)})};r=function(){return $(".draggable").draggable().find("button.close").click(function(){return $(this).closest(".draggable").fadeOut()})};k=function(){if(null==this.gameBean)return g("init: wait"),
setTimeout(k,100);g("init: enter");this.GAME_ID=$(".game").data("id");D();v();F();E();A();B();q();t();s();r();return g("init: leave")};$(function(){return k()})}).call(this);
