(function(){var v,l,m,p,w,x,y,q,z,A,B,C,D,E,F,k,G,r,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,s,Z,t,aa,ba,ca,u,da,ea,n,fa,g=function(a,c){return function(){return a.apply(c,arguments)}};k=function(){};ca=function(){return function(a,c,b){b.prototype=a.prototype;b=new b;a=a.apply(b,c);return Object(a)===a?a:b}(choco.Timer,arguments,function(){})};this.tr=function(a){return i18nBean.tr(a)};G=function(a){return i18nBean.getLangShortName(a)};D=function(a){return cacheBean.cacheImage(a)};E=function(){this.HTML_EMPTY=
Haml.render(".empty "+("("+tr("Empty")+")"));this.HAML_SAMPLE_IMAGE=Haml('%a(href="#{url}" title="#{url}")\n  %img.img-rounded.zoom.zoom-cg(src="#{url}")');this.HAML_VIDEO=Haml(('.video(data-id="${vid}")\n  .header\n    %a.tts(role="button" data-text="${title}" title="TTS")\n      %span.fa.fa-volume-down\n    %a.title.cursor-pointer(title="'+tr("Play")+'") = title\n    :if date\n      .date = date\n    .toolbar.pull-right\n      %button.close(type="button" title="'+tr("Close")+'") &times;\n      %a.btn.btn-link.btn-xs(role="button" href="http://youtube.com/watch?v=${vid}" title="http://youtube.com/watch?v=${vid}")\n        %span.fa.fa-external-link\n  .image\n    %img.img-rounded(src="${img}" title="${title} ${date}")\n  .iframe').replace(/\$/g,
"#"));this.HAML_SETTINGS=Haml(".body.form-horizontal\n  :if file.encoding\n    .row.encoding\n      %label.control-label.col-xs-2 = tr('Encoding')\n      .form-control-static.col-xs-10 = file.encoding.toUpperCase()\n  :if file.threads\n    :if file.threads.scene\n      .row.thread\n        %label.control-label.col-xs-2 \u5bfe\u8a71\n        .form-control-static.col-xs-10\n          = file.threads.scene.name\n          = ' '\n          = file.threads.scene.sig.toString(16)\n    :if file.threads.name\n      .row.thread\n        %label.control-label.col-xs-2 \u540d\u524d\n        .form-control-static.col-xs-10\n          = file.threads.name.name\n          = ' '\n          = file.threads.name.sig.toString(16)\n  .row.hcode\n    %label.control-label.col-xs-2 = tr('H-code')\n    .form-control-static.col-xs-10\n      :if file.hook\n        %span.text-danger = file.hook.text\n        :if file.hook.locked\n          %b.text-info = ' (' + tr('Locked') + ')'\n          %i.text-muted.text-xs\n            = ' -- '\n            = tr('This h-code is definite correct and not allowed to change')\n      :else\n        %span.text-muted = tr('Not specified')");
this.HAML_USERS=Haml((':for it in users\n  :if it.userName && it.count\n    .user(data-name="${it.userName}")\n      :if it.userAvatarUrl\n        %a.user-link(title="'+tr("Show")+'")\n          %img.img-circle.avatar(src="${it.userAvatarUrl}")\n      .header\n        %a.user-link(title="'+tr("Show")+'") @${it.userName}\n      .footer ${it.count} / ${it.langName}').replace(/\$/g,"#"));this.HAML_SCAPE_REVIEWLIST=Haml(".list = entries\n.footer\n  :if empty\n    .empty "+("("+tr("No more")+")")+'\n  :else\n    %button.btn-more.btn.btn-info(type="button" title="'+
tr("More")+'") '+tr("More"));return this.HAML_SCAPE_REVIEW=Haml(('.entry.entry-new(data-content-length="${contentLength}")\n  .header\n    %span.field.text-minor = count\n    :if date\n      %span.field.text-success = date\n    :if score\n      %span.field.text-danger\u00a0${score}/100\n    :if ecchiScore\n      %span.field.text-info H:${ecchiScore}/5\n    %a.user.pull-right(href="${userUrl}" title="${userUrl}") @${user}\n    :if netabare\n      %span.netabare.field.pull-right.text-danger = \'(\u30cd\u30bf\u30d0\u30ec)\'\n  .body\n    :if title\n      .title(title="\u4e00\u8a00\u30b3\u30e1\u30f3\u30c8") = title\n    :if content\n      :if lessContent\n        .content.content-more.inactive(title="\u30e1\u30e2") = content\n        .content.content-less(title="\u30e1\u30e2") = lessContent\n        %a.btn-more.btn.btn-link(role="button" title="'+
tr("More")+'") = "'+tr("More")+' (" + contentLength + ")"\n      :else\n        .content(title="\u30e1\u30e2") = content').replace(/\$/g,"#"))};m=function(){function a(a,b,d){this.$el=a;this.count=null!=b?b:0;this.preset=null!=d?d:"section";this.dec=g(this.dec,this);this.inc=g(this.inc,this);this.count&&this.$el.spin("section")}a.prototype.inc=function(a){null==a&&(a=1);if(0<a)return 0>=this.count&&this.$el.spin(this.preset),this.count+=a};a.prototype.dec=function(a){null==a&&(a=1);if(0<a&&(this.count-=
a,0>=this.count))return this.$el.spin(!1)};return a}();v=function(){function a(a,b){this.$container=a;this.paused=null!=b?b:!1;this.resume=g(this.resume,this);this.pause=g(this.pause,this);this.timer=ca(600,this.pause)}a.prototype.pause=function(){this.paused||(this.paused=!0,this.$container.masonry({isAnimated:!1,transitionDuration:0}));return this.timer.start()};a.prototype.resume=function(){this.timer.stop();if(this.paused)return this.paused=!1,this.$container.masonry({isAnimated:!0,transitionDuration:400})};
return a}();p=1;w=function(){function a(a){this.viewBean=a;this.youtubeFrameHeight=g(this.youtubeFrameHeight,this);this.youtubeFrameWidth=g(this.youtubeFrameWidth,this);this.zoomYoutube=g(this.zoomYoutube,this);this.youtubeWidth=g(this.youtubeWidth,this);this.zoom=g(this.zoom,this);this.bind=g(this.bind,this);this.maxWidth=g(this.maxWidth,this);this.ratio=1;this.bind()}a.prototype.maxWidth=function(){return Math.max(0,this.viewBean.width()-90)};a.prototype.bind=function(){return $(window).resize(function(a){return function(){return a.zoomYoutube(a.ratio)}}(this))};
a.prototype.zoom=function(a){var b;p=this.ratio=a;$("img.zoom.zoom-cover").width(230*(a+1)/2);b=$("img.zoom.zoom-cg");b.length&&(b.width(220*a),$("section.cg .images:visible").masonry());return this.zoomYoutube(a)};a.prototype.youtubeWidth=function(a){return Math.min(220*(null!=a?a:this.ratio),this.maxWidth())};a.prototype.zoomYoutube=function(a){return $(".youtube:not(.iframe)").width(this.youtubeWidth*a)};a.prototype.youtubeFrameWidth=function(){return Math.min(480*this.ratio,Math.max(480,this.maxWidth()))};
a.prototype.youtubeFrameHeight=function(){return 9*this.youtubeFrameWidth()/16};return a}();S=function(){var a;k("bindToolbar: enter");this.zoomer=new w(this.viewBean);a=new ZoomSlider(function(a){return function(b){return a.zoomer.zoom(1+2*b)}}(this));new Toolbar(this.viewBean,{width:60,height:244,move:a.reloadOffset});return k("bindToolbar: leave")};O=function(){k("bindRuby: enter");$.fn.inject=function(){return this.each(function(){return window.injectruby(this)})};$(".ruby").inject();return k("bindRuby: leave")};
F=function(a){return twttr.widgets.createTimeline(a.id,a.el,a.callback,a.options)};da=function(a){return HAML_SAMPLE_IMAGE({url:a})};X=function(a){a=gameBean.getSampleImages(a).split(",");return[a.length,a.map(da).join("")]};fa=function(a){null==a.date&&(a.date="");a.img=gameBean.getYouTubeImageUrl(a.vid,!0);return HAML_VIDEO(a)};ba=function(){return JSON.parse(gameBean.getVideos()).map(fa).join("")};aa=function(a){return'<iframe width="480" height="360" src="http://youtube.com/embed/'+a+'" frameborder="0" allowfullscreen />'};
Z=function(a){return HAML_SETTINGS({file:a})};t=function(a){var c,b,d;b=0;for(d=a.length;b<d;b++)c=a[b],c.langName=G(c.lang)||"*",c.userAvatar&&(c.userAvatarUrl=D("http://media.getchute.com/media/"+c.userAvatar+"/128x128"));return HAML_USERS({users:a})};W=function(a){return"scape"===a?Y():gameBean.getReview(a)};n=function(a){return null!=a?a.replace(/\n/g,"<br/>"):void 0};l=0;ea=function(a){var c,b,d,e;++l;try{return b=0,a.okazu_tokuten&&0>a.okazu_tokuten&&-10<a.okazu_tokuten&&(b=-a.okazu_tokuten),
c=d="",a.memo&&(c=n(a.memo),200<a.memo.length&&(d=n(a.memo.slice(0,201)+" \u2026\u2026"))),HAML_SCAPE_REVIEW({count:l,user:a.uid,userUrl:"http://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/user_infomation.php?user="+a.uid,date:a.timestamp,netabare:a.netabare,score:a.tokuten||0,ecchiScore:b,title:n(a.hitokoto),content:c,contentLength:null!=(e=a.memo)?e.length:void 0,lessContent:d})}catch(h){return'<div class="entry entry-empty"/>'}};s=function(a,c){var b,d;return(b=gameBean.getScapeReviews(a,c))?
(b=JSON.parse(b),d=b.map(ea).join(""),[d,b.length]):["",0]};Y=function(){var a,c;a=s(0,10);c=a[0];a=a[1];if(c)return HAML_SCAPE_REVIEWLIST({entries:c,empty:10>a})};Q=function(){return $.fn.spin.presets.section={left:"-8px",length:4,radius:4,lines:12,width:1}};R=function(){N();P();U();T();return V()};P=function(){var a,c,b,d;b=$("section.settings");a=b.find(".contents");d=b.find(".spin");c=b.find(".msg");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,h){if(h){if(a.hasClass("rendered"))return a.fadeIn();
a.show().addClass("rendered");d.spin("section");return rest.forum.query("game",{data:{id:GAME_ID,select:"file"},error:function(){d.spin(!1);a.removeClass("rendered");return c.addClass("text-danger").text("(Internet "+tr("error")+")")},success:function(b){d.spin(!1);return b.file?(c.empty(),b=Z(b.file),a.hide().html(b).fadeIn()):c.removeClass("text-danger").text(" ("+tr("Empty")+")")}})}return a.fadeOut()})};U=function(){var a,c,b,d;b=$("section.users");a=b.find(".contents");d=b.find(".spin");c=b.find(".msg");
return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,h){if(h){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");d.spin("section");return rest.forum.query("game",{data:{id:GAME_ID,select:"users"},error:function(){d.spin(!1);a.removeClass("rendered");return c.addClass("text-danger").text("(Internet "+tr("error")+")")},success:function(b){d.spin(!1);return(b=b.users||b.subs)?(c.empty(),b=t(b),a.hide().html(b).fadeIn().find("a.user-link").click(function(){var a;
a=$(this).closest(".user").data("name");return mainBean.showUser(a)})):c.removeClass("text-danger").text(" ("+tr("Empty")+")")}})}return a.fadeOut()})};N=function(){var a,c,b,d;b=$("section.stats");a=b.find(".contents");d=b.find(".spin");c=b.find(".msg");return b.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,h){if(h){if(a.hasClass("rendered"))return a.fadeIn();a.show().addClass("rendered");d.spin("section");return rest.forum.query("game",{data:{id:GAME_ID,select:"users"},
error:function(){d.spin(!1);a.removeClass("rendered");return c.addClass("text-danger").text("(Internet "+tr("error")+")")},success:function(b){d.spin(!1);return(b=b.users||b.subs)?(c.empty(),b=t(b),a.hide().html(b).fadeIn()):c.removeClass("text-danger").text(" ("+tr("Empty")+")")}})}return a.fadeOut()})};T=function(){var a,c;c=$("section.twitter");a=c.find(".widgets");return c.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,c){var e,h,f,g,k,l;if(window.twttr)if(c){if(a.hasClass("rendered"))return a.fadeIn();
a.show().addClass("rendered");if(e=gameBean.getTwitterWidgets()){k=e.split(",");l=[];f=0;for(g=k.length;f<g;f++)h=k[f],e=document.createElement("div"),e.className="timeline",a.append(e),l.push(F({id:h,el:e,options:{lang:i18nBean.lang(),width:480,height:500,chrome:"transparent noborders noheader",showReplies:!0}}));return l}}else return a.fadeOut()})};V=function(){var a,c,b;c=$("section.youtube");a=c.find(".videos");b=c.find(".spin");return c.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",
function(c,e){if(e)return b.addClass("spin-running").spin("section"),a.hide().html(ba()).fadeIn().imagesLoaded(function(){return b.removeClass("spin-running").spin(!1)}),C();a.empty();if(b.hasClass("spin-running"))return b.removeClass("spin-running").spin(!1)})};C=function(){var a;a=$("section.youtube .video");if(a.length)return a.find(".image > img").load(function(){var a;if(120===this.naturalWidth)return a=$(this),a=a.closest(".video").data("id"),this.src=a=gameBean.getYouTubeImageUrl(a,!1)}),a.find(".tts").click(function(){return ttsBean.speak(this.dataset.text)}),
a.find("a.title,img,button.close").click(function(){var a,b;b=$(this).closest(".video");b.find("img");a=b.find("iframe");a.length?(b.removeClass("play"),a.remove()):(b.addClass("play"),a=b.data("id"),a=aa(a),b.find(".iframe").html(a));return!1})};K=function(){H();I();J();return M()};J=function(){var a,c,b,d;c=$("section.descriptions");a=c.find(".contents");b=c.find(".spin");d=new m(b);return c.find(".nav.nav-pills > li > a").click(function(){var b,c,f;c=$(this).parent("li");c.hasClass("active")||
(b=c.parent("ul").children("li.active").removeClass("active").data("type"),c.addClass("active"),c=c.data("type"),b&&a.children("."+b).hide(),c&&(b=a.children("."+c),b.length?b.fadeIn():(d.inc(),f=gameBean.getDescription(c),b=document.createElement("div"),b.className=c+" description",b.innerHTML=f,$(b).hide().appendTo(a).fadeIn().imagesLoaded(function(){return d.dec()}).find("a:not([title])").each(function(){return this.setAttribute("title",this.href)}))));return!1})};I=function(){var a,c,b,d;c=$("section.characters");
a=c.find(".contents");b=c.find(".spin");d=new m(b);return c.find(".nav.nav-pills > li > a").click(function(){var b,c,f;c=$(this).parent("li");c.hasClass("active")||(b=c.parent("ul").children("li.active").removeClass("active").data("type"),c.addClass("active"),c=c.data("type"),b&&a.children("."+b).hide(),c&&(b=a.children("."+c),b.length?b.fadeIn():(d.inc(),f=gameBean.getCharacterDescription(c),b=document.createElement("div"),b.className=c+" character",b.innerHTML=f,$(b).hide().appendTo(a).fadeIn().imagesLoaded(function(){return d.dec()}).find("a:not([title])").each(function(){return this.setAttribute("title",
this.href)}))));return!1})};M=function(){var a,c,b;c=$("section.reviews");a=c.find(".contents");b=c.find(".spin");return c.find(".nav.nav-pills > li > a").click(function(){var c,e,h;e=$(this).parent("li");e.hasClass("active")||(c=e.parent("ul").children("li.active").removeClass("active").data("type"),e.addClass("active"),e=e.data("type"),c&&a.children("."+c).hide(),e&&(c=a.children("."+e),c.length?c.fadeIn():(b.spin("section"),h=W(e),c=document.createElement("div"),c.className=e+" review",c.innerHTML=
h||HTML_EMPTY,$(c).hide().appendTo(a).fadeIn(),q(),b.spin(!1),"scape"===e&&h&&z(b))));return!1})};q=function(){return $(".scape .entry.entry-new").each(function(){return $(this).removeClass("entry-new").find(".btn-more").click(function(){var a,c,b,d;d=$(this);b=d.closest(".entry");c=b.find(".content.content-more");a=b.find(".content.content-less");c.toggleClass("inactive");a.toggleClass("inactive");a=b.data("content-length");c=c.hasClass("inactive");d.text(""+tr(c?"More":"Less")+" ("+a+")");return b.effect("highlight",
1E3)})})};u=function(){return(l-10)%20};z=function(a){return $(".scape .footer .btn-more").click(function(){var c,b,d,e;b=$(this);c=b.closest(".scape").find(".list");d=!1;u()||(a.spin("section"),e=s(l,20),e=e[0],a.spin(!1),e&&($(e).hide().appendTo(c).fadeIn(),q(),d=u()));d&&b.replaceWith(HTML_EMPTY);return!1})};H=function(){var a,c,b,d;c=$("section.cg");a=c.find(".contents");b=c.find(".spin");d=new m(b);return c.find(".nav.nav-pills > li > a").click(function(){var b,c,f;c=$(this).parent("li");c.hasClass("active")||
(b=c.parent("ul").children("li.active").removeClass("active").data("type"),c.addClass("active"),c=c.data("type"),b&&a.children("."+b).hide(),c&&(b=a.children("."+c),b.length?b.fadeIn().masonry():(f=X(c),b=f[0],f=f[1],d.inc(b),b=document.createElement("div"),b.className=c+" images",b.innerHTML=f,function(b){var c;c=null;return b.hide().appendTo(a).fadeIn().masonry({itemSelector:"img",isFitWidth:!0}).find("img").load(function(){d.dec();~this.src.indexOf("pics.dmm.")&&90===this.naturalWidth&&122===this.naturalHeight?
(null==c&&(c=new v(b)),c.pause(),b.masonry("remove",this)):$(this).width(220*p);return b.masonry()})}($(b)))));return!1})};L=function(){$.fn.raty.defaults.path=JQUERY_RATY_PATH;$.fn.raty.defaults.hints=["","","","",""];$.fn.raty.round={down:.5,up:1,full:1};return $(".raty").each(function(){return $(this).raty({readOnly:!0,half:!0})})};x=function(){$(".btn-dl-img").click(function(){gameBean.saveImages();return!1});return $(".btn-dl-yt").click(function(){gameBean.saveVideos();return!1})};B=function(){return $(".tts").click(function(){return ttsBean.speak(this.dataset.text)})};
A=function(){return $("a.search").click(function(){var a;a=this.dataset.text||$.trim(this.textContent);return gameBean.search(a)})};y=function(){return $(".draggable").draggable().find("button.close").click(function(){return $(this).closest(".draggable").fadeOut()})};r=function(){if(null==this.gameBean)return k("init: wait"),setTimeout(r,100);k("init: enter");this.GAME_ID=$(".game").data("id");Q();E();S();R();K();L();O();x();B();A();y();return k("init: leave")};$(function(){return r()})}).call(this);
