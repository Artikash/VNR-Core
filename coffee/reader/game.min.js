(function(){var n,k,p,q,r,s,d,g,t,u,v,w,x,y,z,e=function(a,b){return function(){return a.apply(b,arguments)}};d=function(){};n=Haml('%a(href="#{url}" title="#{url}")\n  %img.img-rounded.zoom.zoom-cg(src="#{url}")');z=function(a){return n({url:a})};y=function(){return gameBean.getSampleImages().split(",").map(z).join("")};s=function(a){return twttr.widgets.createTimeline(a.id,a.el,a.callback,a.options)};this.initAmazonReview=function(){var a;d("initAmazonReview: enter");a=$("iframe.amazon");a.load(function(){var b,
a;a=$(this);b=a.contents().find("body");return b.html()?(b.css("background-color","transparent").find(".crIFrame").css("margin-left","-0.8em"),b.find(".crIFrameLogo,.crIframeHeaderTitle").remove()):a.remove()});$(window).on("scroll resize",function(){var b;b=this.viewBean.width();return a.width(b-74)});$("iframe.amazon").error(function(){return $(this).remove()});return d("initAmazonReview: leave")};this.bindYoutube=function(){var a;d("bindYoutube: enter");a=function(b){var a,c;c=Math.round(zoomer.youtubeFrameWidth());
a=Math.round(zoomer.youtubeFrameHeight());return'<iframe width="'+c+'" height="'+a+'" src="http://youtube.com/embed/'+b+'" frameborder="0" allowfullscreen />'};$(".btn-dl-img").click(function(){gameBean.saveImages();return!1});$(".btn-dl-yt").click(function(){gameBean.saveVideos();return!1});$(".youtube .btn-dl").click(function(){var b;b=$(this).closest(".youtube").data("id");youtubeBean.get(b);return!1});$(".youtube .btn-play,.youtube .label,.youtube img").click(function(){var b,h,c,d,f;f=$(this).closest(".youtube");
d=f.find(".label");c=f.find("img");h=f.find("iframe");b=f.find(".btn-play");h.length?(b.prop("title","\u518d\u751f").find(".fa-stop").removeClass("fa-stop").addClass("fa-play"),d.removeClass("label-info").removeClass("label-success"),h.remove(),h=zoomer.youtubeWidth(),b="",f.removeClass("iframe").width(h).height(b),c.show()):(b.prop("title","\u505c\u6b62").find(".fa-play").removeClass("fa-play").addClass("fa-stop"),d.removeClass("label-info").addClass("label-success"),c.hide(),h="100%",b=zoomer.youtubeFrameHeight()+
30,f.addClass("iframe").width(h).height(b),c=f.data("id"),b=a(c),f.append(b));return!1});return d("bindYoutube: leave")};k=1;p=function(){function a(b){this.viewBean=b;this.youtubeFrameHeight=e(this.youtubeFrameHeight,this);this.youtubeFrameWidth=e(this.youtubeFrameWidth,this);this.zoomYoutube=e(this.zoomYoutube,this);this.youtubeWidth=e(this.youtubeWidth,this);this.zoom=e(this.zoom,this);this.bind=e(this.bind,this);this.maxWidth=e(this.maxWidth,this);this.ratio=1;this.bind()}a.prototype.maxWidth=
function(){return Math.max(0,this.viewBean.width()-90)};a.prototype.bind=function(){return $(window).resize(function(b){return function(){return b.zoomYoutube(b.ratio)}}(this))};a.prototype.zoom=function(b){var a;k=this.ratio=b;$("img.zoom.zoom-cover").width(230*(b+1)/2);a=$("img.zoom.zoom-cg");a.length&&(a.width(220*b),$("section.cg .images").masonry());return this.zoomYoutube(b)};a.prototype.youtubeWidth=function(a){return Math.min(220*(null!=a?a:this.ratio),this.maxWidth())};a.prototype.zoomYoutube=
function(a){return $(".youtube:not(.iframe)").width(this.youtubeWidth*a)};a.prototype.youtubeFrameWidth=function(){return Math.min(480*this.ratio,Math.max(480,this.maxWidth()))};a.prototype.youtubeFrameHeight=function(){return 9*this.youtubeFrameWidth()/16};return a}();w=function(){var a;d("bindToolbar: enter");this.zoomer=new p(this.viewBean);a=new ZoomSlider(function(a){return function(d){return a.zoomer.zoom(1+2*d)}}(this));new Toolbar(this.viewBean,{width:60,height:244,move:a.reloadOffset});return d("bindToolbar: leave")};
u=function(){d("bindRuby: enter");$.fn.inject=function(){return this.each(function(){return window.injectruby(this)})};$(".ruby").inject();return d("bindRuby: leave")};t=function(){var a;a=$("section.cg");return a.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,d){var c;c=a.find(".images");return d?c.hasClass("rendered")?c.fadeIn():c.hide().html(y()).addClass("rendered").fadeIn().masonry({itemSelector:"img",isFitWidth:!0}).imagesLoaded(function(){c.find("img").width(220*
k);return c.masonry()}):c.fadeOut()})};x=function(){var a;a=$("section.twitter");return a.find("input.switch").bootstrapSwitch().on("switchChange.bootstrapSwitch",function(b,d){var c,e,f,l,k,g,m;if(window.twttr)if(c=a.find(".widgets"),d){if(c.hasClass("rendered"))return c.fadeIn();c.show().addClass("rendered");if(e=gameBean.getTwitterWidgets()){g=e.split(",");m=[];l=0;for(k=g.length;l<k;l++)f=g[l],e=document.createElement("div"),e.className="timeline",c.append(e),m.push(s({id:f,el:e,options:{lang:"ja",
width:300,height:500,chrome:"transparent noborders noheader",showReplies:!0}}));return m}}else return c.fadeOut()})};v=function(){t();return x()};r=function(){return $(".tts").click(function(){return ttsBean.speak(this.dataset.text)})};q=function(){return $("a.search").click(function(){return gameBean.search($.trim(this.textContent))})};g=function(){if(null==this.gameBean)return d("init: wait"),setTimeout(g,100);d("init: enter");w();v();u();r();q();return d("init: leave")};$(function(){return g()})}).call(this);
