(function(){var k,n,p,l,q,e=function(a,g){return function(){return a.apply(g,arguments)}};k=null;n=function(){return k=Haml(('.topic(data-id="${id}" data-type="${type}" data-subject-id="${subjectId}")\n  :if userAvatarUrl\n    %a(href="${userAvatarUrl}" title="'+tr("Avatar")+'")\n      %img.img-circle.avatar(src="${userAvatarUrl}" alt="'+tr("Avatar")+'")\n  .right\n    .header.line\n      .type.text-warning = typeName\n      %a.user(href="javascript:" style="${userStyle}") @${userName}\n      :if createTime\n        .time.text-minor(title="${createTimeString}") = createTime.fromNow()\n      .lang = lang\n      :if updateTime\n        .time.text-success(title="${updateTimeString}") = updateTime.fromNow()\n      :if scores\n        .score\n          .item.text-danger\n            '+
tr("Score")+": ${scores.overall != undefined ? scores.overall : '-'}/10\n          .item.text-warning\n            H: ${scores.ecchi != undefined ? scores.ecchi : '-'}/10\n    .line.title\n      %span.text-minor ${title}\n      :if gameTitle\n        %a.pull-right.link-game.btn.btn-link(title=\""+tr("Show")+'")\n          \u2013\u2013 ${gameTitle}\n    :if content\n      .content.bbcode = content\n    .footer\n      .btn-group.like-group\n        %a.like.btn.btn-link.btn-sm(role="button" title="'+
tr("Like")+'" data-value="${likeCount}")\n          %span.fa.fa-thumbs-up\n          %span.value = likeCount\n        %a.dislike.btn.btn-link.btn-sm(role="button" title="'+tr("Dislike")+'" data-value="${dislikeCount}")\n          %span.fa.fa-thumbs-down\n          %span.value = dislikeCount\n      .btn-group.pull-right\n        :if USER_NAME\n          %a.btn-reply.btn.btn-link.btn-sm(role="button" title="'+tr("Reply")+'")\n            '+tr("Reply")+"\n            :if postCount\n              = ' (' + postCount + ')'\n        :if userName == USER_NAME\n          %a.btn-edit.btn.btn-link.btn-sm(role=\"button\" title=\""+
tr("Edit")+'") '+tr("Edit")+'\n          %a.btn-add.btn.btn-link.btn-sm(role="button" title="'+tr("Add")+'") '+tr("Add")+'\n    :if image\n      .image\n        %a(href="${image.url}" title="${image.title}")\n          %img(src="${image.url}" alt="${image.title}")').replace(/\$/g,"#"))};q=function(a){var g,b;g=b=null;a.createTime&&(g=moment(1E3*a.createTime));a.updateTime>a.createTime&&(b=moment(1E3*a.updateTime));return k({id:a.id,type:a.type,typeName:util.getTopicTypeName(a.type),lang:util.getLangName(a.lang),
subjectId:a.subjectId,gameTitle:"game"===a.subjectType?a.subjectTitle:"",userAvatarUrl:util.getAvatarUrl(a.userAvatar),userStyle:a.userColor?"color:"+a.userColor:"",title:a.title,content:util.renderContent(a.content),createTime:g,updateTime:b,createTimeString:util.formatDate(g),updateTimeString:util.formatDate(b),userName:a.userName,image:a.image?{title:a.image.title,url:util.getImageUrl(a.image)}:null,postCount:a.postCount,likeCount:a.likeCount||0,dislikeCount:a.dislikeCount||0,scores:a.scores})};
l=function(a,g){return postInputBean.newPost(a,g)};p=function(a){return topicEditBean.editTopic(JSON.stringify(a))};this.topicjs={init:function(){return n()},Topic:function(){function a(a,b){this.id=a;this.$sel=b.container;this.show=e(this.show,this);this.updateTopic=e(this.updateTopic,this);this.showTopic=e(this.showTopic,this);this._highlightTopic=e(this._highlightTopic,this);this._bindTopic=e(this._bindTopic,this);this.topic={}}a.prototype._bindTopic=function(){var a,b,c,m,f,e;c=this.$sel.children(".topic");
f=this.topic;e=c.data("id");m=c.data("subject-id");b=c.find("> .right > .header");a=c.find("> .right > .footer");c.find("a.link-game").click(function(){m&&mainBean.showGame(m);return!1});b.find("a.user").click(function(){null!=f&&f.userName&&mainBean.showUser(f.userName);return!1});a.find(".btn-edit").click(function(){p(f);return!1});a.find(".btn-add").click(function(){l(e,"topic");return!1});a.find(".btn-reply").click(function(){l(e,"post");return!1});a.find(".btn.like").click(function(){var b,c,
d,h;f&&USER_NAME&&USER_NAME!==f.userName&&(b=a.find(".btn.dislike.selected"),b.length&&(b.removeClass("selected"),d=b.find(".value"),d.text(-1+Number(d.text()))),c=$(this),h=c.hasClass("selected"),ticket.update({data:{login:USER_NAME,password:USER_PASSWORD,targetType:"topic",targetId:e,type:"like",value:h?0:1},success:function(a){return function(){c.toggleClass("selected");d=c.find(".value");return d.text((h?-1:1)+Number(d.text()))}}(this)}));return!1});return a.find(".btn.dislike").click(function(){var b,
c,d,h;f&&USER_NAME&&USER_NAME!==f.userName&&(b=a.find(".btn.like.selected"),b.length&&(b.removeClass("selected"),d=b.find(".value"),d.text(-1+Number(d.text()))),c=$(this),h=c.hasClass("selected"),ticket.update({data:{login:USER_NAME,password:USER_PASSWORD,targetType:"topic",targetId:e,type:"like",value:h?0:-1},success:function(a){return function(){c.toggleClass("selected");d=c.find(".value");return d.text((h?-1:1)+Number(d.text()))}}(this)}));return!1})};a.prototype._highlightTopic=function(){return this.$sel.effect("highlight",
1500)};a.prototype.showTopic=function(a){return this.updateTopic(a,!1)};a.prototype.updateTopic=function(a,b){var c;this.topic=a;null==b&&(b=!0);c=q(this.topic);this.$sel.html(c);b&&this._highlightTopic();return this._bindTopic()};a.prototype.show=function(a){var b,c;c=a.success;b=this;spin(!0);return rest.forum.query("topic",{data:{id:this.id},error:function(){spin(!1);return growl.warn(tr("Internet error"))},success:function(a){spin(!1);if(a.id)return b.showTopic(a),"function"===typeof c?c():void 0}})};
return a}()}}).call(this);
