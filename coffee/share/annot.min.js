(function(){var k,n,r,s,t,u,v,w,x,y,z,l,p,m,A,q;k=" \n\r\t\f\x0B\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000".split("");l=function(a){return null!=a?a.toString():""};t=function(a,b){var d,g,c,e,f,h;null==b&&(b=k);a=l(a);h=0;f=a.length;g=b.length;for(c=!0;c&&h<f;)for(c=!1,e=-1,d=a.charAt(h);++e<g;)if(d===b[e]){c=!0;++h;break}return h>=f?"":a.substr(h,f)};z=function(a,b){var d,g,c,e,f;null==b&&(b=k);a=l(a);c=a.length-1;g=b.length;
for(e=!0;e&&0<=c;)for(e=!1,f=-1,d=a.charAt(c);++f<g;)if(d===b[f]){e=!0;--c;break}return 0<=c?a.substring(0,c+1):""};A=function(a,b){null==b&&(b=k);a=l(a);return t(z(a,b),b)};p=function(a){return a};r=function(a){return/[0-9a-zA-Z\uff10-\uff19\uff41-\uff5a\uff21-\uff3a]/.test(a)};s=function(a){return/[0-9a-zA-Z\uff10-\uff19\uff41-\uff5a\uff21-\uff3a'"?!,\.]/.test(a)};q=function(){return document.body.classList.contains("annot-opt-tts")};m=function(){return document.body.classList.contains("annot-opt-tr")};
u=function(){if(q())return ttsBean.speak(this.getAttribute("annot-text"))};v=function(){var a,b,d,g,c,e,f;if(m()&&!this.classList.contains("annot-locked")&&!this.classList.contains("annot-translated")){this.classList.add("annot-locked");this.classList.add("annot-translated");b=this.getAttribute("annot-text");d=this.title;this.title=p("\u3061\u3087\u3063\u3068\u307e\u3063\u3066\u3066 > <");f=trBean.translators().split(",");c=0;for(e=f.length;c<e;c++)a=f[c],g=trBean.translateWith(b,a)||p("failed"),
d&&(d+="\n"),this.title=d+=a+": "+g;return this.classList.remove("annot-locked")}};x=function(a,b,d,g){var c,e;c=document.createElement("rb");c.textContent=a;e=document.createElement("rt");e.textContent=b;b=document.createElement("ruby");b.className=g;b.appendChild(c);b.appendChild(e);b.ondblclick=function(){if(a&&q())return ttsBean.speak(a)};d&&(b.onmouseover=function(a){return function(){if(!m())return this.title=a}}(d),b.onmouseout=function(){if(this.title)return this.removeAttribute("title")});
return b};w=function(a){var b,d,g,c,e,f,h,k,l,n,p,m;if(b=jlpBean.parse(a)){a=document.createDocumentFragment();m=JSON.parse(b);k=0;for(n=m.length;k<n;k++){f=m[k];b=document.createElement("span");b.className="annot-ruby";e="";g=!1;l=0;for(p=f.length;l<p;l++)h=f[l],c=h[0],(d=r(c[0]))&&g&&(e+=" ",g=document.createTextNode(" "),b.appendChild(g)),g=s(c.slice(-1)),e+=c,c=x.apply(this,h),b.appendChild(c);e&&(b.setAttribute("annot-text",e),b.onclick=u,b.onmouseover=v);a.appendChild(b)}return a}};y=function(a){var b;
return"#text"===a.nodeName?(b=document.createElement("span"),b.className="annot-src",b.textContent=a.textContent,b):a.cloneNode()};n=function(a,b){var d;a=a.firstChild;for(d=[];null!=a;)3===a.nodeType?b.push(a):1===a.nodeType&&n(a,b),d.push(a=a.nextSibling);return d};this.annotate=function(a){var b,d,g,c,e,f;a.className+=" annot-root";b=[];n(a,b);f=[];c=0;for(e=b.length;c<e;c++)a=b[c],(d=A(a.textContent))?(d=w(d))?(g=y(a),d.appendChild(g),f.push(a.parentNode.replaceChild(d,a))):f.push(void 0):f.push(void 0);
return f}}).call(this);
