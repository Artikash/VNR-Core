.pragma library
var parse=function(o,l){var i=[];var j=true;var m=false;var a=-1;var f=/^\/?(?:b|i|u|pre|center|samp|code|colou?r|size|noparse|url|link|s|q|(block)?quote|img|u?list|li)$/i;var n=/^(:?black|silver|gray|white|maroon|red|purple|fuchsia|green|lime|olive|yellow|navy|blue|teal|aqua|#(?:[0-9a-f]{3})?[0-9a-f]{3})$/i;var p=/^[\\.0-9]{1,8}$/i;var k=/^[-;\/\?:@&=\+\$,_\.!~\*'\(\)%0-9a-z]{1,512}$/i;var g=/([\r\n])|(?:\[([a-z]{1,16})(?:=(?:"|'|)([^\x00-\x1F"'\(\)<>\[\]]{1,256}))?(?:"|'|)\])|(?:\[\/([a-z]{1,16})\])/ig;function e(t,s){return{bbtag:t,etag:s}}function c(s){if(!s||!s.length){return false}return f.test(s)}function b(s,B,A,y,x,u,v){if(B&&B.length){if(!j){return s}switch(B){case"\r":return"";case"\n":return"<br>"}}if(c(A)){var w=A.toLowerCase();if(m){return"["+A+"]"}if(i.length&&(i[i.length-1].bbtag=="url"||i[i.length-1].bbtag=="link")&&a>=0){return"["+A+"]"}switch(w){case"code":i.push(new e(w,"</code></pre>"));j=false;return"<pre><code>";case"pre":i.push(new e(w,"</pre>"));j=false;return"<pre>";case"center":i.push(new e(w,"</center>"));j=false;return"<center>";case"color":case"colour":if(!y||!n.test(y)){y="inherit"}i.push(new e(w,"</span>"));return'<span style="color: '+y+'">';case"size":if(!y||!p.test(y)){y="1"}i.push(new e(w,"</span>"));return'<span style="font-size: '+Math.min(Math.max(y,0.7),3)+'em">';case"s":i.push(new e(w,"</span>"));return'<span style="text-decoration: line-through">';case"noparse":m=true;return"";case"link":case"url":i.push(new e(w,"</a>"));if(y&&k.test(y)){a=-1;return'<a target="_blank" href="'+y+'">'}a=s.length+u;return'<a target="_blank" href="';case"img":i.push(new e(w,'" />'));if(y&&k.test(y)){a=-1;return"<"+w+' src="'+y+""}return"<"+w+' src="';case"q":case"quote":case"blockquote":var C=(w==="q")?"q":"blockquote";i.push(new e(w,"</"+C+">"));return y&&y.length&&k.test(y)?"<"+C+' cite="'+y+'">':"<"+C+">";case"list":i.push(new e("list","</ol>"));return"<ol>";case"ulist":i.push(new e("ulist","</ul>"));return"<ul>";case"b":i.push(new e("b","</strong>"));return"<strong>";case"i":i.push(new e("i","</em>"));return"<em>";default:i.push(new e(w,"</"+w+">"));return"<"+w+">"}}if(c(x)){var z=x.toLowerCase();if(m){if(x=="noparse"){m=false;return""}return"[/"+x+"]"}if(!i.length||i[i.length-1].bbtag!=z){return'<span style="color: red">[/'+x+"]</span>"}if(z=="url"||z=="link"){if(a>0){return'">'+v.substr(a,u-a)+i.pop().etag}return i.pop().etag}else{if(z=="code"||z=="pre"){j=true}}var t=i.pop().etag;return t}return s}var h="",d,r;j=true;if(i==null||i.length){i=new Array(0)}if(o){o=(function(s){return s.replace(/(\[\*\])([^\[]*)/g,function(w,v,u,x,t){return"[li]"+u+"[/li]"})})(o);h=o.replace(g,b);if(m){m=false}if(i.length){d=new String();if(i[i.length-1].bbtag=="url"||i[i.length-1].bbtag=="link"){i.pop();d+='">'+o.substr(a,o.length-a)+"</a>"}while(i.length){d+=i.pop().etag}}}var q=d?h+d:h;if(l){l(q)}else{return q}};